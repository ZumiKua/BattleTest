(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{31:function(e,t,a){e.exports=a(44)},36:function(e,t,a){},37:function(e,t,a){},44:function(e,t,a){"use strict";a.r(t);var n,i=a(0),s=a.n(i),r=a(25),o=a.n(r),l=(a(36),a(37),a(3)),c=a(4),u=a(7),h=a(6),d=a(1),p=a(8),m=a(18),b=a(2);!function(e){e[e.Fire=0]="Fire",e[e.Water=1]="Water",e[e.Earth=2]="Earth",e[e.Wind=3]="Wind",e[e.Electric=4]="Electric"}(n||(n={}));var v,g,f=a(26);function E(e){var t=e.label,a=Object(f.a)(e,["label"]);return s.a.createElement("div",{className:"field is-horizontal"},s.a.createElement("div",{className:"field-label"},s.a.createElement("label",{className:"label"},t)),s.a.createElement("div",{className:"field-body"},s.a.createElement("div",{className:"field"},s.a.createElement("div",{className:"control"},s.a.createElement("input",Object.assign({className:"input"},a))))))}function k(e){var t=e.isLeft?[0,1]:[1,0];return s.a.createElement("table",{className:"position-selector"},s.a.createElement("tbody",null,[0,1,2].map(function(a){return s.a.createElement("tr",null,0!==a||e.isLeft?null:s.a.createElement("td",{className:"frontline",rowSpan:3},"\u524d\u7ebf"),t.map(function(t){return s.a.createElement("td",{className:2*a+t===e.currentPosition?"selected":"",onClick:function(){return e.onPositionChange(2*a+t)}})}),0===a&&e.isLeft?s.a.createElement("td",{className:"frontline",rowSpan:3},"\u524d\u7ebf"):null)})))}var C=(v={},Object(b.a)(v,n.Earth,"\u571f"),Object(b.a)(v,n.Electric,"\u7535"),Object(b.a)(v,n.Fire,"\u706b"),Object(b.a)(v,n.Water,"\u6c34"),Object(b.a)(v,n.Wind,"\u98ce"),v),A=(g={},Object(b.a)(g,n.Earth,"fa-mountain"),Object(b.a)(g,n.Electric,"fa-bolt"),Object(b.a)(g,n.Fire,"fa-fire"),Object(b.a)(g,n.Water,"fa-tint"),Object(b.a)(g,n.Wind,"fa-wind"),g),y=function(e){function t(e){var a;return Object(l.a)(this,t),(a=Object(u.a)(this,Object(h.a)(t).call(this,e))).handleDpChange=a.handleDpChange.bind(Object(d.a)(a)),a.handlePositionChange=a.handlePositionChange.bind(Object(d.a)(a)),a.handleNameChange=a.handleNameChange.bind(Object(d.a)(a)),a}return Object(p.a)(t,e),Object(c.a)(t,[{key:"handleDpChange",value:function(e){var t=this.copyBattler(this.props.battler);t.dp=Number.parseInt(e.target.value),this.props.onBattlerChanged(t)}},{key:"handlePositionChange",value:function(e){var t=Object(m.a)({},this.props.battler,{position:e});this.props.onBattlerChanged(t)}},{key:"handleNameChange",value:function(e){var t=this.copyBattler(this.props.battler);t.name=e.target.value,this.props.onBattlerChanged(t)}},{key:"handleAttributeChange",value:function(e,t){var a=this.copyBattler(this.props.battler);a.attributeResistances[e]=Number.parseInt(t.target.value),this.props.onBattlerChanged(a)}},{key:"copyBattler",value:function(e){return{dp:e.dp,id:e.id,name:e.name,position:e.position,attributeResistances:e.attributeResistances}}},{key:"render",value:function(){var e=this;return s.a.createElement("div",{className:"battler-info-view"},s.a.createElement(E,{label:"DP:",type:"number",onChange:this.handleDpChange,value:this.props.battler.dp}),s.a.createElement("div",{className:"field is-horizontal"},s.a.createElement("div",{className:"field-label is-normal"},s.a.createElement("label",{className:"label"},"\u4f4d\u7f6e")),s.a.createElement("div",{className:"field-body"},s.a.createElement(k,{isLeft:this.props.isLeft,currentPosition:this.props.battler.position,onPositionChange:function(t){return e.handlePositionChange(t)}}))),s.a.createElement(E,{label:"\u540d\u79f0:",type:"text",onChange:this.handleNameChange,value:this.props.battler.name}),s.a.createElement("div",{className:"field is-horizontal"},s.a.createElement("div",{className:"field-label"},s.a.createElement("label",{className:"label"},"\u6297\u6027")),s.a.createElement("div",{className:"field-body"},[n.Earth,n.Electric,n.Fire,n.Water,n.Wind].map(function(t,a){return s.a.createElement("div",{className:"field"},s.a.createElement("p",{className:"control has-icons-left"},s.a.createElement("input",{type:"number",className:"input",value:e.props.battler.attributeResistances[t],onChange:e.handleAttributeChange.bind(e,t),placeholder:C[t]}),s.a.createElement("span",{className:"icon is-small is-left"},s.a.createElement("i",{className:"fas "+A[t]}))))}))),s.a.createElement("div",{className:"is-grouped-right is-grouped field"},s.a.createElement("div",{className:"control"},s.a.createElement("button",{className:"button is-danger",onClick:this.props.onBattlerDeleted},"\u5220\u9664"))))}}]),t}(s.a.Component),S=function(e){function t(e){var a;return Object(l.a)(this,t),(a=Object(u.a)(this,Object(h.a)(t).call(this,e))).side=void 0,a.maxBattlerId=void 0,a.handleHpChange=a.handleHpChange.bind(Object(d.a)(a)),a.handleSpChange=a.handleSpChange.bind(Object(d.a)(a)),a.addBattler=a.addBattler.bind(Object(d.a)(a)),a.side={hp:0,sp:0,battlers:[]},a.maxBattlerId=0,a}return Object(p.a)(t,e),Object(c.a)(t,[{key:"handleHpChange",value:function(e){var t=this.copySide(this.props.side);t.hp=Number.parseInt(e.target.value),this.props.onSideChanged(t)}},{key:"handleSpChange",value:function(e){var t=this.copySide(this.props.side);t.sp=Number.parseInt(e.target.value),this.props.onSideChanged(t)}},{key:"handleBattlerChanged",value:function(e,t){var a=this.copySide(this.props.side);a.battlers[e]=t,this.props.onSideChanged(a)}},{key:"addBattler",value:function(){var e,t=this.copySide(this.props.side),a=t.battlers,i={dp:0,name:"",attributeResistances:(e={},Object(b.a)(e,n.Earth,0),Object(b.a)(e,n.Electric,0),Object(b.a)(e,n.Fire,0),Object(b.a)(e,n.Water,0),Object(b.a)(e,n.Wind,0),e),id:this.maxBattlerId++,position:0};a.push(i),this.props.onSideChanged(t)}},{key:"deleteBattler",value:function(e){var t=this.props.side.battlers.filter(function(t){return t.id!==e});this.props.onSideChanged(Object(m.a)({},this.props.side,{battlers:t}))}},{key:"copySide",value:function(e){return this.side.hp=e.hp,this.side.sp=e.sp,this.side.battlers=e.battlers,this.side}},{key:"render",value:function(){var e=this;return s.a.createElement("div",{className:"column"},s.a.createElement("div",{className:"side-info-view"},s.a.createElement(E,{label:"HP:",className:"input",type:"number",onChange:this.handleHpChange,value:this.props.side.hp}),s.a.createElement(E,{label:"AP:",className:"input",type:"number",onChange:this.handleSpChange,value:this.props.side.sp}),s.a.createElement("div",{className:"battlers-view"},s.a.createElement("label",{className:"label"},"\u89d2\u8272\uff1a"),this.props.side.battlers.map(function(t,a){return s.a.createElement(y,{isLeft:e.props.isLeft,battler:t,onBattlerChanged:e.handleBattlerChanged.bind(e,a),onBattlerDeleted:function(){return e.deleteBattler(t.id)},key:t.id})}),s.a.createElement("button",{className:"button",onClick:this.addBattler},"\u6dfb\u52a0\u89d2\u8272"))))}}]),t}(s.a.Component),N=function(e){function t(e){var a;return Object(l.a)(this,t),(a=Object(u.a)(this,Object(h.a)(t).call(this,e))).action=void 0,a.action={spCost:0,hpDamage:0,attribute:n.Fire,attributeDamage:0,targetArea:[],name:""},a.onAttributeChanged=a.onAttributeChanged.bind(Object(d.a)(a)),a.onAttributeDamageChanged=a.onAttributeDamageChanged.bind(Object(d.a)(a)),a.onHpDamageChanged=a.onHpDamageChanged.bind(Object(d.a)(a)),a.onSpCostChanged=a.onSpCostChanged.bind(Object(d.a)(a)),a.onNameChanged=a.onNameChanged.bind(Object(d.a)(a)),a}return Object(p.a)(t,e),Object(c.a)(t,[{key:"copyAction",value:function(e){return this.action.spCost=e.spCost,this.action.targetArea=e.targetArea,this.action.hpDamage=e.hpDamage,this.action.attribute=e.attribute,this.action.attributeDamage=e.attributeDamage,this.action.name=e.name,this.action}},{key:"handleAreaClicked",value:function(e,t){console.log("handleAreaClicked",e,t);var a=this.copyAction(this.props.action),n=a.targetArea.findIndex(function(a){return a[0]===e&&a[1]===t});n>=0?a.targetArea.splice(n,1):a.targetArea.push([e,t]),this.props.onActionChanged(a)}},{key:"isAreaChecked",value:function(e,t){return void 0!==this.props.action.targetArea.find(function(a){return a[0]===e&&a[1]===t})}},{key:"onAttributeChanged",value:function(e){var t=this.copyAction(this.props.action);t.attribute=Number.parseInt(e.target.value),this.props.onActionChanged(t)}},{key:"onHpDamageChanged",value:function(e){var t=this.copyAction(this.props.action);t.hpDamage=Number.parseInt(e.target.value),this.props.onActionChanged(t)}},{key:"onSpCostChanged",value:function(e){var t=this.copyAction(this.props.action);t.spCost=Number.parseInt(e.target.value),this.props.onActionChanged(t)}},{key:"onAttributeDamageChanged",value:function(e){var t=this.copyAction(this.props.action);t.attributeDamage=Number.parseInt(e.target.value),this.props.onActionChanged(t)}},{key:"onNameChanged",value:function(e){var t=this.copyAction(this.props.action);t.name=e.target.value,this.props.onActionChanged(t)}},{key:"getCellClassName",value:function(e,t){return"action-info-target-cell"+(this.isAreaChecked(e,t)?" checked":"")+(0===e&&0===t?" center":"")}},{key:"render",value:function(){var e=this;return s.a.createElement("div",{className:"action-view"},s.a.createElement(E,{label:"\u540d\u79f0",type:"text",value:this.props.action.name,onChange:this.onNameChanged}),s.a.createElement(E,{label:"HP\u4f24\u5bb3",type:"number",value:this.props.action.hpDamage,onChange:this.onHpDamageChanged}),s.a.createElement(E,{label:"SP\u6d88\u8017",type:"number",value:this.props.action.spCost,onChange:this.onSpCostChanged}),s.a.createElement(E,{label:"\u5c5e\u6027\u4f24\u5bb3",type:"number",value:this.props.action.attributeDamage,onChange:this.onAttributeDamageChanged}),s.a.createElement("div",{className:"field is-horizontal"},s.a.createElement("div",{className:"field-label is-normal"},s.a.createElement("label",{className:"label"},"\u5c5e\u6027")),s.a.createElement("div",{className:"field-body"},s.a.createElement("div",{className:"field"},s.a.createElement("div",{className:"control"},s.a.createElement("div",{className:"select is-fullwidth"},s.a.createElement("select",{onChange:this.onAttributeChanged,value:this.props.action.attribute},s.a.createElement("option",{value:n.Earth},"\u571f"),s.a.createElement("option",{value:n.Electric},"\u7535"),s.a.createElement("option",{value:n.Fire},"\u706b"),s.a.createElement("option",{value:n.Water},"\u6c34"),s.a.createElement("option",{value:n.Wind},"\u98ce"))))))),s.a.createElement("div",{className:"field is-horizontal"},s.a.createElement("div",{className:"field-label is-normal"},s.a.createElement("label",{className:"label"},"\u76ee\u6807\u8303\u56f4")),s.a.createElement("div",{className:"field-body"},s.a.createElement("table",{className:"action-info-target-table"},s.a.createElement("tbody",null,[-2,-1,0,1,2].map(function(t){return s.a.createElement("tr",{key:t},[-2,-1,0,1,2].map(function(a){return s.a.createElement("td",{className:e.getCellClassName(t,a),key:a,onClick:function(n){return e.handleAreaClicked(t,a)}})}))}))))))}}]),t}(s.a.Component);function D(e){return s.a.createElement("div",{className:"modal is-active"},s.a.createElement("div",{className:"modal-background"}),s.a.createElement("div",{className:"modal-card"},s.a.createElement("header",{className:"modal-card-head"},s.a.createElement("p",{className:"modal-card-title"},"\u8bfb\u53d6\u5b58\u6863"),s.a.createElement("button",{className:"delete","aria-label":"close",onClick:e.onClosed})),s.a.createElement("section",{className:"modal-card-body"},s.a.createElement("div",{className:"content"},s.a.createElement("ol",null,e.saves.map(function(t,a){return s.a.createElement("li",{className:"load-names",key:a,onClick:function(){return e.onLoad(t)}},t)}))))))}var O=a(15),j=function(e){function t(e){var a;return Object(l.a)(this,t),(a=Object(u.a)(this,Object(h.a)(t).call(this,e))).state={side:{hp:0,sp:0,battlers:[]},side2:{hp:0,sp:0,battlers:[]},actions:[],loadShowing:!1,saves:[],currentPage:"sides"},a.handleSideChanged=a.handleSideChanged.bind(Object(d.a)(a)),a.handleSide2Changed=a.handleSide2Changed.bind(Object(d.a)(a)),a.onAddAction=a.onAddAction.bind(Object(d.a)(a)),a.onComplete=a.onComplete.bind(Object(d.a)(a)),a}return Object(p.a)(t,e),Object(c.a)(t,[{key:"handleSideChanged",value:function(e){this.setState({side:e})}},{key:"handleSide2Changed",value:function(e){this.setState({side2:e})}},{key:"onActionChanged",value:function(e,t){this.setState(function(a){var n=a.actions;return n[e]=t,{actions:n}})}},{key:"onAddAction",value:function(){this.setState(function(e){var t=e.actions;return t.push({hpDamage:0,spCost:0,attribute:n.Earth,attributeDamage:0,targetArea:[],name:""}),{actions:t}})}},{key:"onComplete",value:function(){this.props.onComplete(this.state.side,this.state.side2,this.state.actions)}},{key:"onSave",value:function(){var e=window.prompt("\u5b58\u6863\u540d\u79f0\uff08\u540c\u540d\u4f1a\u81ea\u52a8\u8986\u76d6\uff09",(new Date).toLocaleString());if(null!==e&&""!==(e=e.trim()))if("_saveMetaItem"!==e){var t,a=JSON.stringify({side:this.state.side,side2:this.state.side2,actions:this.state.actions}),n=localStorage.getItem("_saveMetaItem");if(-1!==(t=null===n?[]:JSON.parse(n)).findIndex(function(t){return t===e})){if(!1===window.confirm("\u5b58\u5728\u540c\u540d\u5b58\u6863\uff0c\u662f\u5426\u8986\u76d6\uff1f"))return}else t.push(e);localStorage.setItem("_saveMetaItem",JSON.stringify(t)),localStorage.setItem(e,a)}else window.alert("\u975e\u6cd5\u540d\u79f0")}},{key:"onLoad",value:function(){var e=localStorage.getItem("_saveMetaItem");if(null!==e){var t=JSON.parse(e);console.log("onLoad",t),this.setState({loadShowing:!0,saves:t})}else alert("\u65e0\u5b58\u6863")}},{key:"onLoadCanceled",value:function(){this.setState({loadShowing:!1})}},{key:"onLoadSelected",value:function(e){var t=localStorage.getItem(e);if(null===t)return alert("\u8bfb\u53d6\u9519\u8bef\uff01"),void this.setState({loadShowing:!1});var a=JSON.parse(t);this.setState({loadShowing:!1,side:a.side,side2:a.side2,actions:a.actions})}},{key:"render",value:function(){var e=this;return s.a.createElement(s.a.Fragment,null,s.a.createElement("div",{className:"container"},s.a.createElement("div",{className:"tabs"},s.a.createElement("ul",null,s.a.createElement("li",{className:"sides"===this.state.currentPage?"is-active":""},s.a.createElement("a",{onClick:function(t){t.preventDefault(),e.setState({currentPage:"sides"})}},"\u89d2\u8272")),s.a.createElement("li",{className:"actions"===this.state.currentPage?"is-active":""},s.a.createElement("a",{onClick:function(t){t.preventDefault(),e.setState({currentPage:"actions"})}},"\u884c\u4e3a")))),"sides"===this.state.currentPage?s.a.createElement("div",{className:"sides-view"},s.a.createElement("div",{className:"columns edit-view-troop-headers"},s.a.createElement("div",{className:"column edit-view-troop-header red"},s.a.createElement("p",null,"\u7ea2\u65b9")),s.a.createElement("div",{className:"column edit-view-troop-header blue"},s.a.createElement("p",null,"\u84dd\u65b9"))),s.a.createElement("div",{className:"columns side-info-views"},s.a.createElement(S,{side:this.state.side,onSideChanged:this.handleSideChanged,isLeft:!0}),s.a.createElement(S,{side:this.state.side2,onSideChanged:this.handleSide2Changed,isLeft:!1}))):null,"actions"===this.state.currentPage?s.a.createElement("div",{className:"actions-view"},this.state.actions.map(function(t,a){return s.a.createElement(N,{action:t,onActionChanged:e.onActionChanged.bind(e,a),key:a})}),s.a.createElement("div",{className:"field"},s.a.createElement("button",{className:"button",onClick:this.onAddAction},"\u6dfb\u52a0"))):null,s.a.createElement("div",{className:"footer-view field is-grouped"},s.a.createElement("p",{className:"control"},s.a.createElement(O.b,{className:"button is-primary",to:"/battle",onClick:this.onComplete},"\u5b8c\u6210")),s.a.createElement("p",{className:"control"},s.a.createElement("button",{className:"button",onClick:function(){return e.onSave()}},"\u4fdd\u5b58")),s.a.createElement("p",{className:"control"},s.a.createElement("button",{className:"button",onClick:function(){return e.onLoad()}},"\u8bfb\u53d6")))),this.state.loadShowing?s.a.createElement(D,{saves:this.state.saves,onClosed:function(){return e.onLoadCanceled()},onLoad:function(t){return e.onLoadSelected(t)}}):null)}}]),t}(s.a.Component),_=a(29),P=function(){function e(t,a){Object(l.a)(this,e),this.dp=void 0,this.attributeResistances=void 0,this.side=void 0,this.currentAttribute=void 0,this.weakState=void 0,this.thisTurnDpDamaged=void 0,this.position=void 0,this.name=void 0,this.id=void 0,this.position=a.position,this.side=t,this.dp=a.dp,this.attributeResistances=a.attributeResistances,this.currentAttribute={attribute:null,point:0},this.weakState=!1,this.thisTurnDpDamaged=!1,this.name=a.name,this.id=a.id}return Object(c.a)(e,[{key:"getCurrentAttribute",value:function(){return this.currentAttribute.attribute}},{key:"getAttributePoint",value:function(){return this.currentAttribute.point}},{key:"applyAttributeDamage",value:function(e,t){var a={dpDamage:0,attributePointAttached:0,knockedIntoWeak:!1,attribute:null};if(this.weakState&&!this.thisTurnDpDamaged&&(a.dpDamage=1,this.dp-=1,this.thisTurnDpDamaged=!0),this.weakState)return a;a.attribute=e,a.attributePointAttached=t,this.currentAttribute.attribute===e?this.currentAttribute.point+=t:(this.currentAttribute.attribute=e,this.currentAttribute.point=t);var n=this.attributeResistances[e];return 0!==n&&n<=this.currentAttribute.point&&(this.weakState=!0,this.currentAttribute.point=0,a.knockedIntoWeak=!0),a}},{key:"onTurnStart",value:function(){this.thisTurnDpDamaged=!1,this.weakState=!1}},{key:"isDead",value:function(){return this.dp<=0}},{key:"isWeakState",value:function(){return this.weakState}}]),e}(),w=function(){function e(t){var a=this;Object(l.a)(this,e),this.opponent=void 0,this.damageMultiplier=void 0,this.thisActionDamageMultiplier=void 0,this.damageMultiplierDelta=void 0,this.battlers=void 0,this.hp=void 0,this.sp=void 0,this.battlers=t.battlers.map(function(e){return new P(a,e)}),this.damageMultiplier=1,this.thisActionDamageMultiplier=1,this.damageMultiplierDelta=.2,this.opponent=null,this.hp=t.hp,this.sp=t.sp}return Object(c.a)(e,[{key:"getBattler",value:function(e){var t=2*e[0]+e[1];return this.battlers.find(function(e){return e.position===t})}},{key:"setOpponent",value:function(e){this.opponent=e}},{key:"applyHpDamage",value:function(e){return this.hp-=e,this.hp<0&&(this.hp=0),{hpDamage:e,isDead:0===this.hp}}},{key:"onDamageWeakState",value:function(e){var t={multiplierAdded:this.damageMultiplierDelta};return this.thisActionDamageMultiplier+=this.damageMultiplierDelta,this.damageMultiplierDelta+=.2,t}},{key:"onActionEnd",value:function(){this.damageMultiplier=this.thisActionDamageMultiplier}},{key:"onTurnStart",value:function(){this.damageMultiplier=1,this.thisActionDamageMultiplier=1,this.damageMultiplierDelta=.2,this.battlers.forEach(function(e){return e.onTurnStart()})}},{key:"getDisplayDamageMultiplier",value:function(){return this.thisActionDamageMultiplier}}]),e}(),B=function(){function e(t,a,n,i){Object(l.a)(this,e),this.user=void 0,this.targets=void 0,this.data=void 0,this.id=void 0,this.attack=void 0,this.targetPoint=void 0,this.data=t,this.targets=null,this.attack=null,this.user=a,this.targetPoint=n,this.id=i}return Object(c.a)(e,[{key:"canUse",value:function(){return!this.user.isDead()}},{key:"step",value:function(){var e=this;if(!this.canUse())return!1;if(null===this.targets){var t=this.user.side.opponent;this.targets=this.data.targetArea.map(function(a){var n=e.targetPoint[0]+a[0],i=e.targetPoint[1]+a[1];if(!(n>2||n<0||i>1||i<0))return t.getBattler([n,i])}).filter(function(e){return void 0!==e})}if(0===this.targets.length)return this.user.side.onActionEnd(),!1;var a=this.targets.shift();return this.attack=new M(this.user,a,this),!0}},{key:"getCurrentAttack",value:function(){return this.attack}}]),e}(),M=function e(t,a,n){Object(l.a)(this,e),this.user=void 0,this.target=void 0,this.action=void 0,this.hpDamageResult=void 0,this.damageMultiplierResult=void 0,this.attributeDamageResult=void 0,this.user=t,this.target=a,this.action=n;var i=this.user.side.damageMultiplier*this.action.data.hpDamage;this.hpDamageResult=this.target.side.applyHpDamage(i),this.damageMultiplierResult=null,this.action.data.attribute===this.target.getCurrentAttribute()&&this.target.isWeakState()&&(this.damageMultiplierResult=this.user.side.onDamageWeakState(this.action)),this.attributeDamageResult=this.target.applyAttributeDamage(this.action.data.attribute,this.action.data.attributeDamage)},I=a(45),R=function(){function e(t,a){Object(l.a)(this,e),this._sideA=void 0,this._sideB=void 0,this._actions=void 0,this._phase=void 0,this._inputtingPhase=void 0,this._actionResults=void 0,this.currentProcessingAction=void 0,this._inputtingAction=void 0,this._currentInputtingBattler=void 0,this._nextActionId=void 0,this._sideA=new w(t),this._sideB=new w(a),this._sideA.setOpponent(this._sideB),this._sideB.setOpponent(this._sideA),this._actions=new I.a([]),this._phase=new I.a(void 0),this._inputtingPhase=new I.a(void 0),this._actionResults=new I.a([]),this._actions.next([]),this._actionResults.next([]),this.currentProcessingAction=void 0,this.startTurn(),this._nextActionId=0}return Object(c.a)(e,[{key:"addAction",value:function(e){return this.checkInputting("decideAction"),!(e.spCost>this._currentInputtingBattler.side.sp)&&(this._inputtingAction=e,this._inputtingPhase.next("decideTarget"),!0)}},{key:"setTarget",value:function(e){this._inputtingAction.spCost<=this._currentInputtingBattler.side.sp&&(this._currentInputtingBattler.side.sp-=this._inputtingAction.spCost,this._actions.value.push(new B(this._inputtingAction,this._currentInputtingBattler,e,this._nextActionId)),++this._nextActionId),this._inputtingPhase.next("decideBattler")}},{key:"selectBattler",value:function(e){this.checkInputting("decideBattler"),this._currentInputtingBattler=e,this._inputtingPhase.next("decideAction")}},{key:"checkInputting",value:function(e){if("inputting"!==this._phase.value)throw new Error("phase must be inputting");if(this._inputtingPhase.value!==e)throw new Error("inputting phase must be "+e)}},{key:"endInputting",value:function(){this._phase.next("processing"),this._inputtingPhase.next(void 0),this._actionResults.value.length=0,this._actionResults.next(this._actionResults.value),this.updateLoop()}},{key:"updateLoop",value:function(){var e=this;this.update(),"processing"===this._phase.value&&setTimeout(function(){return e.updateLoop()},200)}},{key:"update",value:function(){if("inputting"===this._phase.value)throw new Error("You shouldn't call update in inputting state.");for(;;){if(void 0!==this.currentProcessingAction&&this.currentProcessingAction.step())return this._actionResults.value.push(this.currentProcessingAction.getCurrentAttack()),void this._actionResults.next(this._actionResults.value);if(this.currentProcessingAction=this._actions.value.shift(),this._actions.next(this._actions.value),void 0===this.currentProcessingAction){this.startTurn();break}}}},{key:"cancelTargetSelection",value:function(){this.checkInputting("decideTarget"),this._inputtingAction=void 0,this._inputtingPhase.next("decideAction")}},{key:"cancelActionSelection",value:function(){this.checkInputting("decideAction"),this._currentInputtingBattler=void 0,this._inputtingPhase.next("decideBattler")}},{key:"startTurn",value:function(){this._sideA.onTurnStart(),this._sideB.onTurnStart(),this._phase.next("inputting"),this._inputtingPhase.next("decideBattler")}},{key:"onActionDeleted",value:function(e){this.checkInputting("decideBattler");var t=this._actions.value.findIndex(function(t){return t.id===e}),a=this._actions.value.splice(t,1),n=Object(_.a)(a,1)[0];n.user.side.sp+=n.data.spCost,this._actions.next(this._actions.value)}},{key:"phase",get:function(){return this._phase}},{key:"sideA",get:function(){return this._sideA}},{key:"sideB",get:function(){return this._sideB}},{key:"actions",get:function(){return this._actions}},{key:"inputtingPhase",get:function(){return this._inputtingPhase}},{key:"actionResults",get:function(){return this._actionResults}},{key:"inputtingAction",get:function(){return this._inputtingAction}},{key:"targets",get:function(){return void 0===this._currentInputtingBattler?void 0:this._currentInputtingBattler.side.opponent.battlers}}]),e}(),x=a(13);function T(e){var t=e.battler.getCurrentAttribute(),a="\u65e0";if(null!==t)switch(t){case n.Fire:a="\u706b";break;case n.Water:a="\u6c34";break;case n.Wind:a="\u98ce";break;case n.Electric:a="\u7535";break;case n.Earth:a="\u571f"}return s.a.createElement("p",{className:"battler",onClick:function(t){return e.onClick(e.battler)}},s.a.createElement("b",null,e.battler.name)," \xa0",s.a.createElement("b",null,"DP: ")," ",e.battler.dp," | \xa0",s.a.createElement("b",null,"\u5c5e\u6027\uff1a"),a,"[",e.battler.getAttributePoint(),"]",s.a.createElement("span",{className:e.battler.isWeakState()?"":"hidden"},"| \u5f31\u70b9"),s.a.createElement("span",{className:e.battler.isDead()?"":"hidden"},"| \u6b7b\u4ea1"))}function V(e){return s.a.createElement("div",{className:"side-view"},s.a.createElement("p",null,s.a.createElement("b",null,"HP:")," ",e.side.hp),s.a.createElement("p",null,s.a.createElement("b",null,"SP:")," ",e.side.sp),e.side.battlers.map(function(t){return s.a.createElement(T,{battler:t,key:t.id,onClick:e.onBattlerClick})}))}function W(e){return s.a.createElement("tr",null,s.a.createElement(H,{onHover:e.onHover,onClick:e.onClick,x:e.x,y:0,battlers:e.battlers,highlighted:e.highlighted}),s.a.createElement(H,{onHover:e.onHover,onClick:e.onClick,x:e.x,y:1,battlers:e.battlers,highlighted:e.highlighted}))}function H(e){var t=2*e.x+e.y;return s.a.createElement("td",{onMouseLeave:function(){return e.onHover(!1,[e.x,e.y])},onMouseEnter:function(){return e.onHover(!0,[e.x,e.y])},className:"".concat(e.highlighted[t]?"highlighted":""," target-cell"),onClick:function(t){return e.onClick([e.x,e.y])}},null==e.battlers[t]?"":e.battlers[t].name)}var L,F=function(e){function t(e){var a;return Object(l.a)(this,t),(a=Object(u.a)(this,Object(h.a)(t).call(this,e))).state={hoveredPosition:void 0},a.onTargetSelected=a.onTargetSelected.bind(Object(d.a)(a)),a.onHover=a.onHover.bind(Object(d.a)(a)),a}return Object(p.a)(t,e),Object(c.a)(t,[{key:"onTargetSelected",value:function(e){this.props.onTargetSelected(e)}},{key:"onHover",value:function(e,t){e?this.setState({hoveredPosition:t}):this.setState(function(e){return void 0!==e.hoveredPosition&&e.hoveredPosition[0]===t[0]&&e.hoveredPosition[1]===t[1]?{hoveredPosition:void 0}:{hoveredPosition:e.hoveredPosition}})}},{key:"render",value:function(){var e=this,t=[];if(void 0!==this.state.hoveredPosition){var a=this.state.hoveredPosition[0],n=this.state.hoveredPosition[1];this.props.areas.forEach(function(e){var i=a+e[0],s=n+e[1];i>=0&&i<=2&&s>=0&&s<=1&&t.push(2*i+s)})}var i=Array(6).fill(!1);t.forEach(function(e){return i[e]=!0});var r=Array(6).fill(null);return this.props.battlers.forEach(function(e){return r[e.position]=e}),s.a.createElement("div",{className:"modal target"},s.a.createElement("p",{className:"modal-header"},s.a.createElement("span",{className:"modal-title"},"\u9009\u62e9\u76ee\u6807"),s.a.createElement("button",{className:"modal-close anchor-like-button",onClick:function(t){return e.props.onClose()}},"[X]")),s.a.createElement("table",{className:"target-table"},s.a.createElement("tbody",null,[0,1,2].map(function(t){return s.a.createElement(W,{key:t,onHover:e.onHover,onClick:e.onTargetSelected,x:t,battlers:r,highlighted:i})}))))}}]),t}(s.a.Component),J=(L={},Object(b.a)(L,n.Earth,"\u5730"),Object(b.a)(L,n.Electric,"\u7535"),Object(b.a)(L,n.Fire,"\u706b"),Object(b.a)(L,n.Water,"\u6c34"),Object(b.a)(L,n.Wind,"\u98ce"),L);function z(e){var t=null;null!==e.result.attributeDamageResult.attribute&&(t=s.a.createElement(s.a.Fragment,null,s.a.createElement("p",null,"\u9644\u52a0\u4e86 ",e.result.attributeDamageResult.attributePointAttached," \u70b9 ",J[e.result.attributeDamageResult.attribute]," "),s.a.createElement("p",null,e.result.attributeDamageResult.knockedIntoWeak?"\u6253\u5165\u4e86\u5f31\u70b9\u72b6\u6001":"",e.result.attributeDamageResult.dpDamage>0?"\u9020\u6210\u4e86".concat(e.result.attributeDamageResult.dpDamage,"\u70b9DP\u4f24\u5bb3"):""," ")));var a=null;return null!==e.result.damageMultiplierResult&&(a=s.a.createElement("p",null,"\u4f24\u5bb3\u63d0\u5347\u7387\u4e0a\u6da8\u4e86: ",e.result.damageMultiplierResult.multiplierAdded)),s.a.createElement("div",null,s.a.createElement("p",null,e.result.action.user.name," \u5bf9 ",e.result.target.name," \u4f7f\u7528\u4e86 ",e.result.action.data.name),s.a.createElement("p",null,"\u9020\u6210\u4e86 ",e.result.hpDamageResult.hpDamage," \u70b9\u4f24\u5bb3 ",e.result.hpDamageResult.isDead?"\u5bf9\u9762\u5df2\u6b7b\u4ea1":""),t,a)}function U(e){return s.a.createElement("p",{onClick:function(){return e.onClicked(e.action)},className:"action"},s.a.createElement("span",null,e.action.name),"\xa0",s.a.createElement("span",null,s.a.createElement("b",null,"SP\u6d88\u8017:"),e.action.spCost))}function X(e){return s.a.createElement("div",{className:"actions modal"},s.a.createElement("p",{className:"modal-header"},s.a.createElement("span",{className:"modal-title"},"\u9009\u62e9\u884c\u52a8\uff1a"),s.a.createElement("button",{className:"modal-close anchor-like-button",onClick:function(){return e.onActionSelectionClosed()}},"[X]")),e.actionDatas.map(function(t,a){return s.a.createElement(U,{action:t,key:a,onClicked:function(){return e.onActionClicked(t)}})}))}function Y(e){return s.a.createElement("div",{className:"action-records"},e.actions.map(function(t){return s.a.createElement("p",{key:t.id,className:"action-record"},s.a.createElement("span",null,t.user.name),s.a.createElement("span",{className:"action-record-action-name"},t.data.name),s.a.createElement("button",{className:"anchor-like-button action-record-delete",onClick:function(a){a.preventDefault(),e.onActionDeleted(t.id)}},"X"))}))}var $=function(e){function t(e){var a;return Object(l.a)(this,t),(a=Object(u.a)(this,Object(h.a)(t).call(this,e))).subscription=void 0,a.battleVM=void 0,a.previousProps=void 0,a.state={phase:void 0,inputtingPhase:void 0,actionResults:[],actions:[]},a.onActionClicked=a.onActionClicked.bind(Object(d.a)(a)),a.onTargetSelected=a.onTargetSelected.bind(Object(d.a)(a)),a.onBattlerSelected=a.onBattlerSelected.bind(Object(d.a)(a)),a.onTargetSelectionClosed=a.onTargetSelectionClosed.bind(Object(d.a)(a)),a.onActionSelectionClosed=a.onActionSelectionClosed.bind(Object(d.a)(a)),a.onActionDeleted=a.onActionDeleted.bind(Object(d.a)(a)),a}return Object(p.a)(t,e),Object(c.a)(t,[{key:"createVM",value:function(){var e=this;this.subscription.unsubscribe(),this.subscription=new x.a,this.battleVM=void 0,void 0!==this.props.sideA&&void 0!==this.props.sideB&&(this.battleVM=new R(this.props.sideA,this.props.sideB),this.battleVM.phase.subscribe(function(t){return e.setState({phase:t})}),this.battleVM.inputtingPhase.subscribe(function(t){return e.setState({inputtingPhase:t})}),this.battleVM.actionResults.subscribe(function(t){return e.setState({actionResults:t})}),this.battleVM.actions.subscribe(function(t){return e.setState({actions:t})}))}},{key:"recreateBattleVM",value:function(){this.previousProps!==this.props&&(this.previousProps=this.props,void 0!==this.subscription&&(this.subscription.unsubscribe(),this.subscription=void 0),this.battleVM=void 0,void 0!==this.props.sideA&&void 0!==this.props.sideB&&(this.battleVM=new R(this.props.sideA,this.props.sideB)))}},{key:"registerSubscriptions",value:function(){var e=this;if(void 0===this.subscription&&void 0!==this.battleVM){var t=[];t[0]=this.battleVM.phase.subscribe(function(t){return e.setState({phase:t})}),t[1]=this.battleVM.inputtingPhase.subscribe(function(t){return e.setState({inputtingPhase:t})}),t[2]=this.battleVM.actionResults.subscribe(function(t){return e.setState({actionResults:t})}),t[3]=this.battleVM.actions.subscribe(function(t){return e.setState({actions:t})}),this.subscription=new x.a,t.forEach(function(t){return e.subscription.add(t)})}}},{key:"componentDidMount",value:function(){this.registerSubscriptions()}},{key:"componentDidUpdate",value:function(){this.registerSubscriptions()}},{key:"onActionClicked",value:function(e){this.battleVM.addAction(e)}},{key:"onTargetSelected",value:function(e){this.battleVM.setTarget(e)}},{key:"onBattlerSelected",value:function(e){this.battleVM.selectBattler(e)}},{key:"onEndTurn",value:function(){this.battleVM.endInputting()}},{key:"onTargetSelectionClosed",value:function(){this.battleVM.cancelTargetSelection()}},{key:"onActionSelectionClosed",value:function(){this.battleVM.cancelActionSelection()}},{key:"onActionDeleted",value:function(e){this.battleVM.onActionDeleted(e)}},{key:"render",value:function(){var e=this;if(this.recreateBattleVM(),void 0===this.battleVM)return s.a.createElement(s.a.Fragment,null);var t=null;console.log(this.state.inputtingPhase),void 0!==this.props.actionDatas&&"decideAction"===this.state.inputtingPhase&&(t=s.a.createElement(X,{onActionClicked:this.onActionClicked,actionDatas:this.props.actionDatas,onActionSelectionClosed:this.onActionSelectionClosed}));var a=null;return"decideTarget"===this.state.inputtingPhase&&(a=s.a.createElement(F,{battlers:this.battleVM.targets,onTargetSelected:this.onTargetSelected,areas:this.battleVM.inputtingAction.targetArea,onClose:this.onTargetSelectionClosed})),s.a.createElement("div",null,s.a.createElement(V,{side:this.battleVM.sideA,onBattlerClick:this.onBattlerSelected}),s.a.createElement(V,{side:this.battleVM.sideB,onBattlerClick:this.onBattlerSelected}),s.a.createElement(Y,{actions:this.state.actions,onActionDeleted:this.onActionDeleted}),"inputting"===this.state.phase?s.a.createElement("button",{onClick:function(){return e.onEndTurn()}},"\u7ed3\u675f\u56de\u5408"):null,s.a.createElement("div",{className:"modal-container ".concat(null!==t||null!==a?"show":"")},null!==t?t:s.a.createElement(s.a.Fragment,null),null!==a?a:s.a.createElement(s.a.Fragment,null)),this.state.actionResults.map(function(e,t){return s.a.createElement(z,{key:t,result:e})}))}}]),t}(s.a.Component),q=a(14),G=function(e){function t(e){var a;return Object(l.a)(this,t),(a=Object(u.a)(this,Object(h.a)(t).call(this,e))).state={sideA:void 0,sideB:void 0,actions:[]},a.onComplete=a.onComplete.bind(Object(d.a)(a)),a}return Object(p.a)(t,e),Object(c.a)(t,[{key:"onComplete",value:function(e,t,a){this.setState({sideA:e,sideB:t,actions:a})}},{key:"render",value:function(){var e=this;return s.a.createElement("div",null,s.a.createElement(q.a,{render:function(t){return s.a.createElement(j,Object.assign({onComplete:e.onComplete},t))},path:"/",exact:!0}),s.a.createElement(q.a,{render:function(t){return s.a.createElement($,Object.assign({},t,{sideA:e.state.sideA,sideB:e.state.sideB,actionDatas:e.state.actions}))},path:"/battle"}))}}]),t}(s.a.Component),K=function(){return s.a.createElement(G,null)};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));a(42),a(43);o.a.render(s.a.createElement(O.a,null,s.a.createElement(K,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[31,1,2]]]);
//# sourceMappingURL=main.56d1fae0.chunk.js.map