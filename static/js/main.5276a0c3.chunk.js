(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{32:function(e,t,a){e.exports=a(45)},37:function(e,t,a){},38:function(e,t,a){},45:function(e,t,a){"use strict";a.r(t);var n,i=a(0),s=a.n(i),r=a(27),l=a.n(r),o=(a(37),a(38),a(2)),c=a(4),u=a(8),d=a(7),h=a(1),p=a(9),m=a(5),v=a(16),b=a(3);!function(e){e[e.Fire=0]="Fire",e[e.Water=1]="Water",e[e.Earth=2]="Earth",e[e.Wind=3]="Wind",e[e.Electric=4]="Electric"}(n||(n={}));var g,f,E=a(28);function k(e){var t=e.label,a=Object(E.a)(e,["label"]);return s.a.createElement("div",{className:"field is-horizontal"},s.a.createElement("div",{className:"field-label"},s.a.createElement("label",{className:"label"},t)),s.a.createElement("div",{className:"field-body"},s.a.createElement("div",{className:"field"},s.a.createElement("div",{className:"control"},s.a.createElement("input",Object.assign({className:"input"},a))))))}function C(e){var t=e.isLeft?[0,1]:[1,0];return s.a.createElement("table",{className:"position-selector"},s.a.createElement("tbody",null,[0,1,2].map(function(a){return s.a.createElement("tr",{key:a},0!==a||e.isLeft?null:s.a.createElement("td",{className:"frontline",rowSpan:3},"\u524d\u7ebf"),t.map(function(t){return s.a.createElement("td",{key:t,className:2*a+t===e.currentPosition?"selected":"",onClick:function(){return e.onPositionChange(2*a+t)}})}),0===a&&e.isLeft?s.a.createElement("td",{className:"frontline",rowSpan:3},"\u524d\u7ebf"):null)})))}var y=(g={},Object(b.a)(g,n.Earth,"\u571f"),Object(b.a)(g,n.Electric,"\u7535"),Object(b.a)(g,n.Fire,"\u706b"),Object(b.a)(g,n.Water,"\u6c34"),Object(b.a)(g,n.Wind,"\u98ce"),g),S=(f={},Object(b.a)(f,n.Earth,"fa-mountain"),Object(b.a)(f,n.Electric,"fa-bolt"),Object(b.a)(f,n.Fire,"fa-fire"),Object(b.a)(f,n.Water,"fa-tint"),Object(b.a)(f,n.Wind,"fa-wind"),f),A=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(u.a)(this,Object(d.a)(t).call(this,e))).handleDpChange=a.handleDpChange.bind(Object(h.a)(a)),a.handlePositionChange=a.handlePositionChange.bind(Object(h.a)(a)),a.handleNameChange=a.handleNameChange.bind(Object(h.a)(a)),a}return Object(p.a)(t,e),Object(c.a)(t,[{key:"handleDpChange",value:function(e){var t=this.copyBattler(this.props.battler);t.dp=Number.parseInt(e.target.value),this.props.onBattlerChanged(t)}},{key:"handlePositionChange",value:function(e){var t=Object(m.a)({},this.props.battler,{position:e});this.props.onBattlerChanged(t)}},{key:"handleNameChange",value:function(e){var t=this.copyBattler(this.props.battler);t.name=e.target.value,this.props.onBattlerChanged(t)}},{key:"handleAttributeChange",value:function(e,t){var a=this.copyBattler(this.props.battler);a.attributeResistances[e]=Number.parseInt(t.target.value),this.props.onBattlerChanged(a)}},{key:"copyBattler",value:function(e){return{dp:e.dp,id:e.id,name:e.name,position:e.position,attributeResistances:e.attributeResistances}}},{key:"render",value:function(){var e=this;return s.a.createElement("div",{className:"battler-info-view"},s.a.createElement(k,{label:"DP:",type:"number",onChange:this.handleDpChange,value:this.props.battler.dp}),s.a.createElement("div",{className:"field is-horizontal"},s.a.createElement("div",{className:"field-label is-normal"},s.a.createElement("label",{className:"label"},"\u4f4d\u7f6e")),s.a.createElement("div",{className:"field-body"},s.a.createElement(C,{isLeft:this.props.isLeft,currentPosition:this.props.battler.position,onPositionChange:function(t){return e.handlePositionChange(t)}}))),s.a.createElement(k,{label:"\u540d\u79f0:",type:"text",onChange:this.handleNameChange,value:this.props.battler.name}),s.a.createElement("div",{className:"field is-horizontal"},s.a.createElement("div",{className:"field-label"},s.a.createElement("label",{className:"label"},"\u6297\u6027")),s.a.createElement("div",{className:"field-body"},[n.Earth,n.Electric,n.Fire,n.Water,n.Wind].map(function(t){return s.a.createElement("div",{className:"field",key:t},s.a.createElement("p",{className:"control has-icons-left"},s.a.createElement("input",{type:"number",className:"input",value:e.props.battler.attributeResistances[t],onChange:e.handleAttributeChange.bind(e,t),placeholder:y[t]}),s.a.createElement("span",{className:"icon is-small is-left"},s.a.createElement("i",{className:"fas "+S[t]}))))}))),s.a.createElement("div",{className:"is-grouped-right is-grouped field"},s.a.createElement("div",{className:"control"},s.a.createElement("button",{className:"button is-danger",onClick:this.props.onBattlerDeleted},"\u5220\u9664"))))}}]),t}(s.a.Component),N=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(u.a)(this,Object(d.a)(t).call(this,e))).side=void 0,a.maxBattlerId=void 0,a.handleHpChange=a.handleHpChange.bind(Object(h.a)(a)),a.handleSpChange=a.handleSpChange.bind(Object(h.a)(a)),a.addBattler=a.addBattler.bind(Object(h.a)(a)),a.side={hp:0,sp:0,battlers:[]},a.maxBattlerId=0,a}return Object(p.a)(t,e),Object(c.a)(t,[{key:"handleHpChange",value:function(e){var t=this.copySide(this.props.side);t.hp=Number.parseInt(e.target.value),this.props.onSideChanged(t)}},{key:"handleSpChange",value:function(e){var t=this.copySide(this.props.side);t.sp=Number.parseInt(e.target.value),this.props.onSideChanged(t)}},{key:"handleBattlerChanged",value:function(e,t){var a=this.copySide(this.props.side);a.battlers[e]=t,this.props.onSideChanged(a)}},{key:"addBattler",value:function(){var e,t=this.copySide(this.props.side),a=t.battlers,i={dp:0,name:"",attributeResistances:(e={},Object(b.a)(e,n.Earth,0),Object(b.a)(e,n.Electric,0),Object(b.a)(e,n.Fire,0),Object(b.a)(e,n.Water,0),Object(b.a)(e,n.Wind,0),e),id:this.maxBattlerId++,position:0};a.push(i),this.props.onSideChanged(t)}},{key:"deleteBattler",value:function(e){var t=this.props.side.battlers.filter(function(t){return t.id!==e});this.props.onSideChanged(Object(m.a)({},this.props.side,{battlers:t}))}},{key:"copySide",value:function(e){return this.side.hp=e.hp,this.side.sp=e.sp,this.side.battlers=e.battlers,this.side}},{key:"render",value:function(){var e=this;return s.a.createElement("div",{className:"column"},s.a.createElement("div",{className:"side-info-view"},s.a.createElement(k,{label:"HP:",className:"input",type:"number",onChange:this.handleHpChange,value:this.props.side.hp}),s.a.createElement(k,{label:"AP:",className:"input",type:"number",onChange:this.handleSpChange,value:this.props.side.sp}),s.a.createElement("div",{className:"battlers-view"},s.a.createElement("label",{className:"label"},"\u89d2\u8272\uff1a"),this.props.side.battlers.map(function(t,a){return s.a.createElement(A,{isLeft:e.props.isLeft,battler:t,onBattlerChanged:e.handleBattlerChanged.bind(e,a),onBattlerDeleted:function(){return e.deleteBattler(t.id)},key:t.id})}),s.a.createElement("button",{className:"button",onClick:this.addBattler},"\u6dfb\u52a0\u89d2\u8272"))))}}]),t}(s.a.Component),O=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(u.a)(this,Object(d.a)(t).call(this,e))).onAttributeChanged=a.onAttributeChanged.bind(Object(h.a)(a)),a.onAttributeDamageChanged=a.onAttributeDamageChanged.bind(Object(h.a)(a)),a.onHpDamageChanged=a.onHpDamageChanged.bind(Object(h.a)(a)),a.onSpCostChanged=a.onSpCostChanged.bind(Object(h.a)(a)),a.onNameChanged=a.onNameChanged.bind(Object(h.a)(a)),a.onDpRecoveryChanged=a.onDpRecoveryChanged.bind(Object(h.a)(a)),a.onSpRecoveryChanged=a.onSpRecoveryChanged.bind(Object(h.a)(a)),a.onDefenceIncreaseChanged=a.onDefenceIncreaseChanged.bind(Object(h.a)(a)),a}return Object(p.a)(t,e),Object(c.a)(t,[{key:"handleAreaClicked",value:function(e,t){var a=Object(m.a)({},this.props.action,{targetArea:Object(v.a)(this.props.action.targetArea)}),n=a.targetArea.findIndex(function(a){return a[0]===e&&a[1]===t});n>=0?a.targetArea.splice(n,1):a.targetArea.push([e,t]),this.props.onActionChanged(a)}},{key:"isAreaChecked",value:function(e,t){return void 0!==this.props.action.targetArea.find(function(a){return a[0]===e&&a[1]===t})}},{key:"onAttributeChanged",value:function(e){var t=Object(m.a)({},this.props.action,{attribute:Number.parseInt(e.target.value)});this.props.onActionChanged(t)}},{key:"onHpDamageChanged",value:function(e){var t=Object(m.a)({},this.props.action,{hpDamage:Number.parseInt(e.target.value)});this.props.onActionChanged(t)}},{key:"onSpCostChanged",value:function(e){var t=Object(m.a)({},this.props.action,{spCost:Number.parseInt(e.target.value)});this.props.onActionChanged(t)}},{key:"onAttributeDamageChanged",value:function(e){var t=Object(m.a)({},this.props.action,{attributeDamage:Number.parseInt(e.target.value)});this.props.onActionChanged(t)}},{key:"onNameChanged",value:function(e){var t=Object(m.a)({},this.props.action,{name:e.target.value});this.props.onActionChanged(t)}},{key:"onDpRecoveryChanged",value:function(e){var t=Object(m.a)({},this.props.action,{dpRecovery:Number.parseInt(e.target.value)});this.props.onActionChanged(t)}},{key:"onSpRecoveryChanged",value:function(e){var t=Object(m.a)({},this.props.action,{spRecovery:Number.parseInt(e.target.value)});this.props.onActionChanged(t)}},{key:"onDefenceIncreaseChanged",value:function(e){var t=Object(m.a)({},this.props.action,{defenceIncrease:Number.parseInt(e.target.value)});this.props.onActionChanged(t)}},{key:"getCellClassName",value:function(e,t){return"action-info-target-cell"+(this.isAreaChecked(e,t)?" checked":"")+(0===e&&0===t?" center":"")}},{key:"render",value:function(){var e=this;return s.a.createElement("div",{className:"action-view"},s.a.createElement(k,{label:"\u540d\u79f0",type:"text",value:this.props.action.name,onChange:this.onNameChanged}),s.a.createElement(k,{label:"HP\u4f24\u5bb3",type:"number",value:this.props.action.hpDamage,onChange:this.onHpDamageChanged}),s.a.createElement(k,{label:"SP\u6d88\u8017",type:"number",value:this.props.action.spCost,onChange:this.onSpCostChanged}),s.a.createElement(k,{label:"\u5c5e\u6027\u4f24\u5bb3",type:"number",value:this.props.action.attributeDamage,onChange:this.onAttributeDamageChanged}),s.a.createElement(k,{label:"DP\u56de\u590d",type:"number",value:this.props.action.dpRecovery,onChange:this.onDpRecoveryChanged}),s.a.createElement(k,{label:"AP\u56de\u590d",type:"number",value:this.props.action.spRecovery,onChange:this.onSpRecoveryChanged}),s.a.createElement(k,{label:"\u9632\u5fa1\u503c\u589e\u52a0",type:"number",value:this.props.action.defenceIncrease,onChange:this.onDefenceIncreaseChanged}),s.a.createElement("div",{className:"field is-horizontal"},s.a.createElement("div",{className:"field-label is-normal"},s.a.createElement("label",{className:"label"},"\u5c5e\u6027")),s.a.createElement("div",{className:"field-body"},s.a.createElement("div",{className:"field"},s.a.createElement("div",{className:"control"},s.a.createElement("div",{className:"select is-fullwidth"},s.a.createElement("select",{onChange:this.onAttributeChanged,value:this.props.action.attribute},s.a.createElement("option",{value:n.Earth},"\u571f"),s.a.createElement("option",{value:n.Electric},"\u7535"),s.a.createElement("option",{value:n.Fire},"\u706b"),s.a.createElement("option",{value:n.Water},"\u6c34"),s.a.createElement("option",{value:n.Wind},"\u98ce"))))))),s.a.createElement("div",{className:"field is-horizontal"},s.a.createElement("div",{className:"field-label is-normal"},s.a.createElement("label",{className:"label"},"\u76ee\u6807\u8303\u56f4")),s.a.createElement("div",{className:"field-body"},s.a.createElement("table",{className:"action-info-target-table"},s.a.createElement("tbody",null,[-2,-1,0,1,2].map(function(t){return s.a.createElement("tr",{key:t},[-2,-1,0,1,2].map(function(a){return s.a.createElement("td",{className:e.getCellClassName(t,a),key:a,onClick:function(n){return e.handleAreaClicked(t,a)}})}))}))))),s.a.createElement("div",{className:"is-grouped-right is-grouped field"},s.a.createElement("div",{className:"control"},s.a.createElement("button",{className:"button is-danger",onClick:this.props.onActionDeleted},"\u5220\u9664"))))}}]),t}(s.a.Component);function D(e){return s.a.createElement("div",{className:"modal is-active"},s.a.createElement("div",{className:"modal-background"}),s.a.createElement("div",{className:"modal-card"},s.a.createElement("header",{className:"modal-card-head"},s.a.createElement("p",{className:"modal-card-title"},"\u8bfb\u53d6\u5b58\u6863"),s.a.createElement("button",{className:"delete","aria-label":"close",onClick:e.onClosed})),s.a.createElement("section",{className:"modal-card-body"},s.a.createElement("div",{className:"content"},s.a.createElement("ol",null,e.saves.map(function(t,a){return s.a.createElement("li",{className:"load-name",key:a,onClick:function(){return e.onLoad(t)}},s.a.createElement("span",null,t)," ",s.a.createElement("button",{className:"delete",onClick:function(a){e.onDelete(t),a.stopPropagation()}}))}))))))}var j=a(17),R="_saveMetaItem_V2",w=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(u.a)(this,Object(d.a)(t).call(this,e))).maxActionId=void 0,a.state={side:{hp:0,sp:0,battlers:[]},side2:{hp:0,sp:0,battlers:[]},actions:[],loadShowing:!1,saves:[],currentPage:"sides"},a.maxActionId=0,a.handleSideChanged=a.handleSideChanged.bind(Object(h.a)(a)),a.handleSide2Changed=a.handleSide2Changed.bind(Object(h.a)(a)),a.onAddAction=a.onAddAction.bind(Object(h.a)(a)),a.onComplete=a.onComplete.bind(Object(h.a)(a)),a}return Object(p.a)(t,e),Object(c.a)(t,[{key:"handleSideChanged",value:function(e){this.setState({side:e})}},{key:"handleSide2Changed",value:function(e){this.setState({side2:e})}},{key:"onActionChanged",value:function(e,t){this.setState(function(a){var n=Object(v.a)(a.actions),i=n.findIndex(function(t){return t.id===e});return n[i]=Object(m.a)({},n[i],{data:t}),{actions:n}})}},{key:"onAddAction",value:function(){var e=this;this.setState(function(t){var a=Object(v.a)(t.actions);return a.push({id:e.maxActionId++,data:{hpDamage:0,spCost:0,attribute:n.Earth,attributeDamage:0,targetArea:[],name:"",spRecovery:0,dpRecovery:0,defenceIncrease:0}}),{actions:a}})}},{key:"onRemoveAction",value:function(e){this.setState(function(t){var a=Object(v.a)(t.actions),n=a.findIndex(function(t){return t.id===e});return-1!==n&&a.splice(n,1),{actions:a}})}},{key:"onComplete",value:function(){this.props.onComplete(this.state.side,this.state.side2,this.state.actions.map(function(e){return e.data}))}},{key:"onSave",value:function(){var e=window.prompt("\u5b58\u6863\u540d\u79f0\uff08\u540c\u540d\u4f1a\u81ea\u52a8\u8986\u76d6\uff09",(new Date).toLocaleString());if(null!==e&&""!==(e=e.trim()))if(e!==R){var t,a=JSON.stringify({side:this.state.side,side2:this.state.side2,actions:this.state.actions.map(function(e){return e.data})}),n=localStorage.getItem(R);if(-1!==(t=null===n?[]:JSON.parse(n)).findIndex(function(t){return t===e})){if(!1===window.confirm("\u5b58\u5728\u540c\u540d\u5b58\u6863\uff0c\u662f\u5426\u8986\u76d6\uff1f"))return}else t.push(e);localStorage.setItem(R,JSON.stringify(t)),localStorage.setItem(e,a)}else window.alert("\u975e\u6cd5\u540d\u79f0")}},{key:"onLoad",value:function(){var e=localStorage.getItem(R);if(null!==e){var t=JSON.parse(e);0!==t.length?this.setState({loadShowing:!0,saves:t}):alert("\u65e0\u5b58\u6863")}else alert("\u65e0\u5b58\u6863")}},{key:"onLoadCanceled",value:function(){this.setState({loadShowing:!1})}},{key:"onDeleteSave",value:function(e){var t=localStorage.getItem(R);if(null===t)return alert("\u8bfb\u53d6\u9519\u8bef\uff01"),void this.setState({loadShowing:!1});var a=JSON.parse(t),n=a.indexOf(e);if(-1===n)return alert("\u8bfb\u53d6\u9519\u8bef\uff01"),void this.setState({loadShowing:!1});a.splice(n,1),localStorage.setItem(R,JSON.stringify(a)),localStorage.removeItem(e),0===a.length?this.setState({loadShowing:!1,saves:a}):this.setState({loadShowing:!0,saves:a})}},{key:"onLoadSelected",value:function(e){var t=this,a=localStorage.getItem(e);if(null===a)return alert("\u8bfb\u53d6\u9519\u8bef\uff01"),void this.setState({loadShowing:!1});var n=JSON.parse(a);this.setState({loadShowing:!1,side:n.side,side2:n.side2,actions:n.actions.map(function(e){return{id:t.maxActionId++,data:e}})})}},{key:"render",value:function(){var e=this;return s.a.createElement(s.a.Fragment,null,s.a.createElement("div",{className:"container"},s.a.createElement("div",{className:"tabs"},s.a.createElement("ul",null,s.a.createElement("li",{className:"sides"===this.state.currentPage?"is-active":""},s.a.createElement("a",{onClick:function(t){t.preventDefault(),e.setState({currentPage:"sides"})}},"\u89d2\u8272")),s.a.createElement("li",{className:"actions"===this.state.currentPage?"is-active":""},s.a.createElement("a",{onClick:function(t){t.preventDefault(),e.setState({currentPage:"actions"})}},"\u884c\u4e3a")))),"sides"===this.state.currentPage?s.a.createElement("div",{className:"sides-view"},s.a.createElement("div",{className:"columns edit-view-troop-headers"},s.a.createElement("div",{className:"column edit-view-troop-header red"},s.a.createElement("p",null,"\u7ea2\u65b9")),s.a.createElement("div",{className:"column edit-view-troop-header blue"},s.a.createElement("p",null,"\u84dd\u65b9"))),s.a.createElement("div",{className:"columns side-info-views"},s.a.createElement(N,{side:this.state.side,onSideChanged:this.handleSideChanged,isLeft:!0}),s.a.createElement(N,{side:this.state.side2,onSideChanged:this.handleSide2Changed,isLeft:!1}))):null,"actions"===this.state.currentPage?s.a.createElement("div",{className:"actions-view"},this.state.actions.map(function(t){return s.a.createElement(O,{action:t.data,onActionChanged:e.onActionChanged.bind(e,t.id),key:t.id,onActionDeleted:function(){return e.onRemoveAction(t.id)}})}),s.a.createElement("div",{className:"field"},s.a.createElement("button",{className:"button",onClick:this.onAddAction},"\u6dfb\u52a0"))):null,s.a.createElement("div",{className:"footer-view field is-grouped"},s.a.createElement("p",{className:"control"},s.a.createElement(j.b,{className:"button is-primary",to:"/battle",onClick:this.onComplete},"\u5b8c\u6210")),s.a.createElement("p",{className:"control"},s.a.createElement("button",{className:"button",onClick:function(){return e.onSave()}},"\u4fdd\u5b58")),s.a.createElement("p",{className:"control"},s.a.createElement("button",{className:"button",onClick:function(){return e.onLoad()}},"\u8bfb\u53d6")))),this.state.loadShowing?s.a.createElement(D,{saves:this.state.saves,onClosed:function(){return e.onLoadCanceled()},onLoad:function(t){return e.onLoadSelected(t)},onDelete:function(t){return e.onDeleteSave(t)}}):null)}}]),t}(s.a.Component),P=a(20),B=function(){function e(t,a){Object(o.a)(this,e),this.maxDp=void 0,this.dp=void 0,this.attributeResistances=void 0,this.side=void 0,this.currentAttribute=void 0,this.weakState=void 0,this.thisTurnDpDamaged=void 0,this.position=void 0,this.name=void 0,this.id=void 0,this.defence=void 0,this.position=a.position,this.side=t,this.dp=a.dp,this.maxDp=a.dp,this.attributeResistances=a.attributeResistances,this.currentAttribute={attribute:null,point:0},this.weakState=!1,this.thisTurnDpDamaged=!1,this.name=a.name,this.id=a.id,this.defence=0}return Object(c.a)(e,[{key:"getCurrentAttribute",value:function(){return this.currentAttribute.attribute}},{key:"getAttributePoint",value:function(){return this.currentAttribute.point}},{key:"applyAttributeDamage",value:function(e,t){var a={dpDamage:0,attributePointAttached:0,knockedIntoWeak:!1,attribute:null};if(this.weakState&&!this.thisTurnDpDamaged&&(a.dpDamage=1,this.dp-=1,this.thisTurnDpDamaged=!0),this.weakState)return a;a.attribute=e,a.attributePointAttached=t,this.currentAttribute.attribute===e?this.currentAttribute.point+=t:(this.currentAttribute.attribute=e,this.currentAttribute.point=t);var n=this.attributeResistances[e];return 0!==n&&n<=this.currentAttribute.point&&(this.weakState=!0,this.currentAttribute.point=0,a.knockedIntoWeak=!0),a}},{key:"applyDpRecovery",value:function(e){var t=this.dp;return this.dp+=e,this.dp>=this.maxDp&&(this.dp=this.maxDp),this.dp<0&&(this.dp=0),this.dp-t}},{key:"applyDefenceIncrease",value:function(e){return this.defence+=e,console.log(this,e),e}},{key:"applyHpDamage",value:function(e){var t;return this.defence<e?(t=this.defence,e-=this.defence,this.defence=0):(this.defence-=e,t=e,e=0),Object(m.a)({},this.side.applyHpDamage(e),{defended:t})}},{key:"onTurnStart",value:function(){this.thisTurnDpDamaged&&(this.weakState=!1),this.thisTurnDpDamaged=!1,this.defence=0}},{key:"isDead",value:function(){return this.dp<=0}},{key:"isWeakState",value:function(){return this.weakState}}]),e}();function _(e){return[Math.floor(e/2),e%2]}function I(e,t){return 2*e+t}var M,x=function(){function e(t){var a=this;Object(o.a)(this,e),this.opponent=void 0,this.damageMultiplier=void 0,this.thisActionDamageMultiplier=void 0,this.damageMultiplierDelta=void 0,this.battlers=void 0,this.hp=void 0,this.sp=void 0,this.battlers=t.battlers.map(function(e){return new B(a,e)}),this.damageMultiplier=1,this.thisActionDamageMultiplier=1,this.damageMultiplierDelta=.2,this.opponent=null,this.hp=t.hp,this.sp=t.sp}return Object(c.a)(e,[{key:"getBattler",value:function(e){var t=2*e[0]+e[1];return this.battlers.find(function(e){return e.position===t})}},{key:"setOpponent",value:function(e){this.opponent=e}},{key:"applyHpDamage",value:function(e){return this.hp-=e,this.hp<0&&(this.hp=0),{hpDamage:e,isDead:0===this.hp}}},{key:"applySpRecovery",value:function(e){var t=this.sp;return this.sp+=e,this.sp>=10&&(this.sp=10),this.sp<0&&(this.sp=0),this.sp-t}},{key:"onDamageWeakState",value:function(e){var t={multiplierAdded:this.damageMultiplierDelta};return this.thisActionDamageMultiplier+=this.damageMultiplierDelta,this.damageMultiplierDelta+=.2,t}},{key:"onActionEnd",value:function(){this.damageMultiplier=this.thisActionDamageMultiplier}},{key:"onTurnStart",value:function(){this.damageMultiplier=1,this.thisActionDamageMultiplier=1,this.damageMultiplierDelta=.2,this.battlers.forEach(function(e){return e.onTurnStart()}),this.sp<=3&&(this.sp=3)}},{key:"getDisplayDamageMultiplier",value:function(){return this.thisActionDamageMultiplier}}]),e}(),T=function(){function e(t,a,n,i,s){Object(o.a)(this,e),this.user=void 0,this.targets=void 0,this.data=void 0,this.id=void 0,this.attack=void 0,this.targetPoint=void 0,this.targetSide=void 0,this.data=t,this.targets=null,this.attack=null,this.user=a,this.targetPoint=n,this.targetSide=i,this.id=s}return Object(c.a)(e,[{key:"canUse",value:function(){return!this.user.isDead()}},{key:"step",value:function(){var e=this;if(!this.canUse())return!1;if(null===this.targets){var t=this.targetSide;this.targets=this.data.targetArea.map(function(a){var n=e.targetPoint[0]+a[0],i=e.targetPoint[1]+a[1];if(!(n>2||n<0||i>1||i<0))return t.getBattler([n,i])}).filter(function(e){return void 0!==e})}if(0===this.targets.length)return this.user.side.onActionEnd(),!1;var a=this.targets.shift();return this.attack=new L(this.user,a,this),!0}},{key:"getCurrentAttack",value:function(){return this.attack}}]),e}(),L=function e(t,a,n){Object(o.a)(this,e),this.user=void 0,this.target=void 0,this.action=void 0,this.hpDamageResult=void 0,this.spRecoveryResult=void 0,this.dpRecoveryResult=void 0,this.defenceIncreaseResult=void 0,this.damageMultiplierResult=void 0,this.attributeDamageResult=void 0,this.user=t,this.target=a,this.action=n;var i=this.user.side.damageMultiplier*this.action.data.hpDamage;this.hpDamageResult=this.target.applyHpDamage(i),this.damageMultiplierResult=null,this.spRecoveryResult=this.target.side.applySpRecovery(this.action.data.spRecovery),this.dpRecoveryResult=this.target.applyDpRecovery(this.action.data.dpRecovery),this.defenceIncreaseResult=this.target.applyDefenceIncrease(this.action.data.defenceIncrease),this.action.data.attribute===this.target.getCurrentAttribute()&&this.target.isWeakState()&&(this.damageMultiplierResult=this.user.side.onDamageWeakState(this.action)),this.attributeDamageResult=this.target.applyAttributeDamage(this.action.data.attribute,this.action.data.attributeDamage)},V=a(46),W=function(){function e(t,a){Object(o.a)(this,e),this._sideA=void 0,this._sideB=void 0,this._actions=void 0,this._phase=void 0,this._inputtingPhase=void 0,this._actionResults=void 0,this.currentProcessingAction=void 0,this._inputtingAction=void 0,this._currentInputtingBattler=void 0,this._nextActionId=void 0,this._sideA=new x(t),this._sideB=new x(a),this._sideA.setOpponent(this._sideB),this._sideB.setOpponent(this._sideA),this._actions=new V.a([]),this._phase=new V.a(void 0),this._inputtingPhase=new V.a(void 0),this._actionResults=new V.a([]),this._actions.next([]),this._actionResults.next([]),this.currentProcessingAction=void 0,this.startTurn(),this._nextActionId=0}return Object(c.a)(e,[{key:"addAction",value:function(e){return this.checkInputting("decideAction"),!(e.spCost>this._currentInputtingBattler.side.sp)&&(this._inputtingAction=e,this._inputtingPhase.next("decideTarget"),!0)}},{key:"setTarget",value:function(e,t){if(this._inputtingAction.spCost<=this._currentInputtingBattler.side.sp){this._currentInputtingBattler.side.sp-=this._inputtingAction.spCost;var a=t?this.sideA:this.sideB;this._actions.value.push(new T(this._inputtingAction,this._currentInputtingBattler,e,a,this._nextActionId)),++this._nextActionId}this._inputtingPhase.next("decideBattler")}},{key:"selectBattler",value:function(e){this.checkInputting("decideBattler"),this._currentInputtingBattler=e,this._inputtingPhase.next("decideAction")}},{key:"checkInputting",value:function(e){if("inputting"!==this._phase.value)throw new Error("phase must be inputting");if(this._inputtingPhase.value!==e)throw new Error("inputting phase must be "+e)}},{key:"endInputting",value:function(){this._phase.next("processing"),this._inputtingPhase.next(void 0),this._actionResults.value.length=0,this._actionResults.next(this._actionResults.value),this.updateLoop()}},{key:"updateLoop",value:function(){var e=this;this.update(),"processing"===this._phase.value&&setTimeout(function(){return e.updateLoop()},200)}},{key:"update",value:function(){if("inputting"===this._phase.value)throw new Error("You shouldn't call update in inputting state.");for(;;){if(void 0!==this.currentProcessingAction&&this.currentProcessingAction.step())return this._actionResults.value.push(this.currentProcessingAction.getCurrentAttack()),void this._actionResults.next(this._actionResults.value);if(this.currentProcessingAction=this._actions.value.shift(),this._actions.next(this._actions.value),void 0===this.currentProcessingAction){this.startTurn();break}}}},{key:"cancelTargetSelection",value:function(){this.checkInputting("decideTarget"),this._inputtingAction=void 0,this._inputtingPhase.next("decideAction")}},{key:"cancelActionSelection",value:function(){this.checkInputting("decideAction"),this._currentInputtingBattler=void 0,this._inputtingPhase.next("decideBattler")}},{key:"startTurn",value:function(){this._sideA.onTurnStart(),this._sideB.onTurnStart(),this._phase.next("inputting"),this._inputtingPhase.next("decideBattler")}},{key:"onActionDeleted",value:function(e){this.checkInputting("decideBattler");var t=this._actions.value.findIndex(function(t){return t.id===e}),a=this._actions.value.splice(t,1),n=Object(P.a)(a,1)[0];n.user.side.sp+=n.data.spCost,this._actions.next(this._actions.value)}},{key:"phase",get:function(){return this._phase}},{key:"sideA",get:function(){return this._sideA}},{key:"sideB",get:function(){return this._sideB}},{key:"actions",get:function(){return this._actions}},{key:"inputtingPhase",get:function(){return this._inputtingPhase}},{key:"actionResults",get:function(){return this._actionResults}},{key:"inputtingAction",get:function(){return this._inputtingAction}},{key:"targets",get:function(){return void 0===this._currentInputtingBattler?void 0:this._currentInputtingBattler.side.opponent.battlers}}]),e}(),H=a(15),F=(M={},Object(b.a)(M,n.Earth,"\u5730"),Object(b.a)(M,n.Electric,"\u7535"),Object(b.a)(M,n.Fire,"\u706b"),Object(b.a)(M,n.Water,"\u6c34"),Object(b.a)(M,n.Wind,"\u98ce"),M);function J(e){return void 0===e.battler?s.a.createElement("td",{onMouseEnter:function(){return e.enter(e.pos)},onMouseLeave:function(){return e.exit(e.pos)}}):s.a.createElement("td",{onMouseEnter:function(){return e.enter(e.pos)},onMouseLeave:function(){return e.exit(e.pos)},onClick:function(){return e.onClick(e.battler)}},s.a.createElement("p",null,e.battler.name),s.a.createElement("p",null,e.battler.isDead()?s.a.createElement("span",{className:"icon"},s.a.createElement("i",{className:"fas fa-skull"})):null,e.battler.isWeakState()?s.a.createElement("span",{className:"icon"},s.a.createElement("i",{className:"fas fa-heart-broken"})):null))}function z(e){if(void 0===e.battler)return s.a.createElement("div",{className:"detail-view"});var t=e.battler.getCurrentAttribute();return console.log("BattlerDetailView",e.battler),s.a.createElement("div",{className:"detail-view"},s.a.createElement("p",null,e.battler.name,e.battler.isDead()?s.a.createElement("span",{className:"icon"},s.a.createElement("i",{className:"fas fa-skull"})):null,e.battler.isWeakState()?s.a.createElement("span",{className:"icon"},s.a.createElement("i",{className:"fas fa-heart-broken"})):null),s.a.createElement("p",null,s.a.createElement("b",null,"DP:")," ",e.battler.dp),s.a.createElement("p",null,s.a.createElement("b",null,"\u6297:"),e.battler.defence),null===t?null:s.a.createElement("p",null,s.a.createElement("b",null,F[t])," ",e.battler.getAttributePoint()))}var U=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(u.a)(this,Object(d.a)(t).call(this,e))).state={pos:void 0},a}return Object(p.a)(t,e),Object(c.a)(t,[{key:"onEnterBattler",value:function(e){this.setState({pos:e})}},{key:"onExitBattler",value:function(e){this.setState(function(t){return t.pos===e?{pos:void 0}:{pos:t.pos}})}},{key:"render",value:function(){var e=this,t=this.props.battlers.reduce(function(e,t){return e[t.position]=t,e},{}),a=this.props.isLeft?[0,1]:[1,0],n=void 0===this.state.pos?void 0:t[this.state.pos];return s.a.createElement(s.a.Fragment,null,s.a.createElement("table",{className:"battle-field-view"},s.a.createElement("tbody",null,[0,1,2].map(function(n){return s.a.createElement("tr",{key:n},0!==n||e.props.isLeft?null:s.a.createElement("td",{rowSpan:3,className:"frontline"},s.a.createElement("span",null,"\u524d\u7ebf")),a.map(function(a){return s.a.createElement(J,{pos:2*n+a,key:a,battler:t[2*n+a],enter:function(t){return e.onEnterBattler(t)},exit:function(t){return e.onExitBattler(t)},onClick:e.props.onBattlerClick})}),0===n&&e.props.isLeft?s.a.createElement("td",{rowSpan:3,className:"frontline"},s.a.createElement("span",null,"\u524d\u7ebf")):null)}))),s.a.createElement(z,{battler:n}))}}]),t}(s.a.Component);function X(e){return s.a.createElement("div",{className:"side-view column is-6"+(e.isRed?" red":" blue")},s.a.createElement("div",null,s.a.createElement("p",null,s.a.createElement("b",null,"HP:")," ",e.side.hp),s.a.createElement("p",null,s.a.createElement("b",null,"SP:")," ",e.side.sp),s.a.createElement(U,{isLeft:e.isRed,battlers:e.side.battlers,onBattlerClick:e.onBattlerClick})))}function Y(e){return s.a.createElement("td",{onMouseEnter:function(){return e.onEnter()},onMouseLeave:function(){return e.onExit()},className:e.highlighted?"highlighted":"",onClick:function(){return e.onClick()}},e.name)}var $=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(u.a)(this,Object(d.a)(t).call(this,e))).state={hoveredPosition:void 0},a.onTargetSelected=a.onTargetSelected.bind(Object(h.a)(a)),a}return Object(p.a)(t,e),Object(c.a)(t,[{key:"onTargetSelected",value:function(e,t){this.props.onTargetSelected(e,t)}},{key:"onEnter",value:function(e,t){this.setState({hoveredPosition:{isLeft:e,pos:t}})}},{key:"onExit",value:function(e,t){this.setState(function(a){return void 0!==a.hoveredPosition&&a.hoveredPosition.isLeft===e&&a.hoveredPosition.pos===t?{hoveredPosition:void 0}:{hoveredPosition:a.hoveredPosition}})}},{key:"render",value:function(){var e=this,t=[];if(void 0!==this.state.hoveredPosition){var a=_(this.state.hoveredPosition.pos),n=Object(P.a)(a,2),i=n[0],r=n[1];this.props.areas.forEach(function(e){var a=i+e[0],n=r+e[1];a>=0&&a<=2&&n>=0&&n<=1&&t.push(2*a+n)})}var l=Array(6).fill(!1);t.forEach(function(e){return l[e]=!0});var o=Array(6).fill(null),c=Array(6).fill(null);return this.props.battlersLeft.forEach(function(e){return o[e.position]=e}),this.props.battlersRight.forEach(function(e){return c[e.position]=e}),s.a.createElement("div",{className:"modal target-view is-active"},s.a.createElement("div",{className:"modal-background"}),s.a.createElement("div",{className:"modal-card"},s.a.createElement("header",{className:"modal-card-head"},s.a.createElement("p",{className:"modal-card-title"},"\u9009\u62e9\u76ee\u6807"),s.a.createElement("button",{className:"delete","aria-label":"close",onClick:function(){return e.props.onClose()}})),s.a.createElement("section",{className:"modal-card-body"},s.a.createElement("table",{className:"target-view-table"},s.a.createElement("tbody",null,[0,1,2].map(function(t){return s.a.createElement("tr",{key:t},[0,1].map(function(a){var n=I(t,a),i=o[n],r=null===i?"":i.name,c=!!(void 0!==e.state.hoveredPosition&&e.state.hoveredPosition.isLeft)&&l[n];return s.a.createElement(Y,{key:a,onClick:function(){return e.onTargetSelected(n,!0)},onEnter:function(){return e.onEnter(!0,n)},onExit:function(){return e.onExit(!0,n)},pos:n,name:r,highlighted:c})}),0===t?s.a.createElement("td",{rowSpan:3,className:"target-view-frontline"},"\u524d\u7ebf"):null,[1,0].map(function(a){var n=I(t,a),i=c[n],r=null===i?"":i.name,o=!!(void 0!==e.state.hoveredPosition&&!e.state.hoveredPosition.isLeft)&&l[n];return s.a.createElement(Y,{key:a,onClick:function(){return e.onTargetSelected(n,!1)},onEnter:function(){return e.onEnter(!1,n)},onExit:function(){return e.onExit(!1,n)},pos:n,name:r,highlighted:o})}))}))))))}}]),t}(s.a.Component);function q(e){var t=null;null!==e.result.attributeDamageResult.attribute&&(t=s.a.createElement(s.a.Fragment,null,s.a.createElement("p",null,"\u9644\u52a0\u4e86 ",e.result.attributeDamageResult.attributePointAttached," \u70b9 ",F[e.result.attributeDamageResult.attribute]," "),s.a.createElement("p",null,e.result.attributeDamageResult.knockedIntoWeak?"\u6253\u5165\u4e86\u5f31\u70b9\u72b6\u6001":"",e.result.attributeDamageResult.dpDamage>0?"\u9020\u6210\u4e86".concat(e.result.attributeDamageResult.dpDamage,"\u70b9DP\u4f24\u5bb3"):""," ")));var a=null;null!==e.result.damageMultiplierResult&&(a=s.a.createElement("p",null,"\u4f24\u5bb3\u63d0\u5347\u7387\u4e0a\u6da8\u4e86: ",e.result.damageMultiplierResult.multiplierAdded));var n=null;0!==e.result.dpRecoveryResult&&(n=s.a.createElement("p",null,"DP\u56de\u590d\u4e86\uff1a",e.result.dpRecoveryResult," "));var i=null;0!==e.result.spRecoveryResult&&(i=s.a.createElement("p",null,"SP\u56de\u590d\u4e86\uff1a",e.result.spRecoveryResult," "));var r=null;return 0!==e.result.defenceIncreaseResult&&(r=s.a.createElement("p",null,"\u9632\u5fa1\u4e0a\u6da8\u4e86\uff1a",e.result.defenceIncreaseResult)),s.a.createElement("div",{className:"result-view"},s.a.createElement("p",null,e.result.action.user.name," \u5bf9 ",e.result.target.name," \u4f7f\u7528\u4e86 ",e.result.action.data.name),s.a.createElement("p",null,"\u6d88\u8017\u4e86",e.result.hpDamageResult.defended,"\u70b9\u9632\u5fa1"),s.a.createElement("p",null,"\u9020\u6210\u4e86 ",e.result.hpDamageResult.hpDamage," \u70b9\u4f24\u5bb3 ",e.result.hpDamageResult.isDead?"\u5bf9\u9762\u5df2\u6b7b\u4ea1":""),t,a,n,i,r)}function G(e){return s.a.createElement("p",{className:"action",onClick:function(){return e.onClicked(e.action)}},s.a.createElement("span",{className:"name"},e.action.name),"\xa0",s.a.createElement("span",{className:"sp-cost"},s.a.createElement("b",null,"SP\u6d88\u8017:"),e.action.spCost))}function K(e){return s.a.createElement("div",{className:"actions-selection modal is-active"},s.a.createElement("div",{className:"modal-background"}),s.a.createElement("div",{className:"modal-card"},s.a.createElement("header",{className:"modal-card-head"},s.a.createElement("p",{className:"modal-card-title"},"\u9009\u62e9\u884c\u52a8"),s.a.createElement("button",{className:"delete","aria-label":"close",onClick:function(){return e.onActionSelectionClosed()}})),s.a.createElement("section",{className:"modal-card-body"},e.actionDatas.map(function(t,a){return s.a.createElement(G,{action:t,key:a,onClicked:function(){return e.onActionClicked(t)}})}))))}function Q(e){return s.a.createElement("div",{className:"action-records"},e.actions.map(function(t){return s.a.createElement("p",{key:t.id,className:"action-record"},s.a.createElement("span",null,t.user.name),s.a.createElement("span",{className:"action-record-action-use"},"\u4f7f\u7528\u4e86"),s.a.createElement("span",{className:"action-record-action-name"},t.data.name),s.a.createElement("button",{className:"delete action-record-delete",onClick:function(a){a.preventDefault(),e.onActionDeleted(t.id)}},"X"))}))}var Z=a(13),ee=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(u.a)(this,Object(d.a)(t).call(this,e))).subscription=void 0,a.battleVM=void 0,a.previousProps=void 0,a.state={phase:void 0,inputtingPhase:void 0,actionResults:[],actions:[]},a.onActionClicked=a.onActionClicked.bind(Object(h.a)(a)),a.onTargetSelected=a.onTargetSelected.bind(Object(h.a)(a)),a.onBattlerSelected=a.onBattlerSelected.bind(Object(h.a)(a)),a.onTargetSelectionClosed=a.onTargetSelectionClosed.bind(Object(h.a)(a)),a.onActionSelectionClosed=a.onActionSelectionClosed.bind(Object(h.a)(a)),a.onActionDeleted=a.onActionDeleted.bind(Object(h.a)(a)),a}return Object(p.a)(t,e),Object(c.a)(t,[{key:"createVM",value:function(){var e=this;this.subscription.unsubscribe(),this.subscription=new H.a,this.battleVM=void 0,void 0!==this.props.sideA&&void 0!==this.props.sideB&&(this.battleVM=new W(this.props.sideA,this.props.sideB),this.battleVM.phase.subscribe(function(t){return e.setState({phase:t})}),this.battleVM.inputtingPhase.subscribe(function(t){return e.setState({inputtingPhase:t})}),this.battleVM.actionResults.subscribe(function(t){return e.setState({actionResults:t})}),this.battleVM.actions.subscribe(function(t){return e.setState({actions:t})}))}},{key:"recreateBattleVM",value:function(){this.previousProps!==this.props&&(this.previousProps=this.props,void 0!==this.subscription&&(this.subscription.unsubscribe(),this.subscription=void 0),this.battleVM=void 0,void 0!==this.props.sideA&&void 0!==this.props.sideB&&(this.battleVM=new W(this.props.sideA,this.props.sideB)))}},{key:"registerSubscriptions",value:function(){var e=this;if(void 0===this.subscription&&void 0!==this.battleVM){var t=[];t[0]=this.battleVM.phase.subscribe(function(t){return e.setState({phase:t})}),t[1]=this.battleVM.inputtingPhase.subscribe(function(t){return e.setState({inputtingPhase:t})}),t[2]=this.battleVM.actionResults.subscribe(function(t){return e.setState({actionResults:t})}),t[3]=this.battleVM.actions.subscribe(function(t){return e.setState({actions:t})}),this.subscription=new H.a,t.forEach(function(t){return e.subscription.add(t)})}}},{key:"componentDidMount",value:function(){this.registerSubscriptions()}},{key:"componentDidUpdate",value:function(){this.registerSubscriptions()}},{key:"onActionClicked",value:function(e){this.battleVM.addAction(e)}},{key:"onTargetSelected",value:function(e,t){this.battleVM.setTarget(_(e),t)}},{key:"onBattlerSelected",value:function(e){this.battleVM.selectBattler(e)}},{key:"onEndTurn",value:function(){this.battleVM.endInputting()}},{key:"onTargetSelectionClosed",value:function(){this.battleVM.cancelTargetSelection()}},{key:"onActionSelectionClosed",value:function(){this.battleVM.cancelActionSelection()}},{key:"onActionDeleted",value:function(e){this.battleVM.onActionDeleted(e)}},{key:"render",value:function(){var e=this;if(this.recreateBattleVM(),void 0===this.battleVM)return s.a.createElement(Z.a,{to:"/"});var t=null;console.log(this.state.inputtingPhase),void 0!==this.props.actionDatas&&"decideAction"===this.state.inputtingPhase&&(t=s.a.createElement(K,{onActionClicked:this.onActionClicked,actionDatas:this.props.actionDatas,onActionSelectionClosed:this.onActionSelectionClosed}));var a=null;return"decideTarget"===this.state.inputtingPhase&&(a=s.a.createElement($,{battlersLeft:this.battleVM.sideA.battlers,battlersRight:this.battleVM.sideB.battlers,onTargetSelected:this.onTargetSelected,areas:this.battleVM.inputtingAction.targetArea,onClose:this.onTargetSelectionClosed})),s.a.createElement("div",{className:"container battle-view"},s.a.createElement("div",{className:"columns"},s.a.createElement(X,{isRed:!0,side:this.battleVM.sideA,onBattlerClick:this.onBattlerSelected}),s.a.createElement(X,{isRed:!1,side:this.battleVM.sideB,onBattlerClick:this.onBattlerSelected})),s.a.createElement(Q,{actions:this.state.actions,onActionDeleted:this.onActionDeleted}),s.a.createElement("div",{className:"control"},"inputting"===this.state.phase?s.a.createElement("button",{className:"button",onClick:function(){return e.onEndTurn()}},"\u7ed3\u675f\u56de\u5408"):null),s.a.createElement("div",{className:"modal-container ".concat(null!==t||null!==a?"show":"")},null!==t?t:s.a.createElement(s.a.Fragment,null),null!==a?a:s.a.createElement(s.a.Fragment,null)),this.state.actionResults.map(function(e,t){return s.a.createElement(q,{key:t,result:e})}))}}]),t}(s.a.Component),te=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(u.a)(this,Object(d.a)(t).call(this,e))).state={sideA:void 0,sideB:void 0,actions:[]},a.onComplete=a.onComplete.bind(Object(h.a)(a)),a}return Object(p.a)(t,e),Object(c.a)(t,[{key:"onComplete",value:function(e,t,a){this.setState({sideA:e,sideB:t,actions:a})}},{key:"render",value:function(){var e=this;return s.a.createElement("div",null,s.a.createElement(Z.b,{render:function(t){return s.a.createElement(w,Object.assign({onComplete:e.onComplete},t))},path:"/",exact:!0}),s.a.createElement(Z.b,{render:function(t){return s.a.createElement(ee,Object.assign({},t,{sideA:e.state.sideA,sideB:e.state.sideB,actionDatas:e.state.actions}))},path:"/battle"}))}}]),t}(s.a.Component),ae=function(){return s.a.createElement(te,null)};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));a(43),a(44);l.a.render(s.a.createElement(j.a,null,s.a.createElement(ae,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[32,1,2]]]);
//# sourceMappingURL=main.5276a0c3.chunk.js.map