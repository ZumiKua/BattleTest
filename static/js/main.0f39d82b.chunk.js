(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{14:function(t,e,n){t.exports=n(22)},20:function(t,e,n){},21:function(t,e,n){},22:function(t,e,n){"use strict";n.r(e);var a,i,s=n(0),r=n.n(s),o=n(11),l=n.n(o),c=(n(20),n(21),n(2)),u=n(3),h=n(7),d=n(5),p=n(1),m=n(6),g=n(4);!function(t){t[t.Fire=0]="Fire",t[t.Water=1]="Water",t[t.Earth=2]="Earth",t[t.Wind=3]="Wind",t[t.Electric=4]="Electric"}(a||(a={}));var b=(i={},Object(g.a)(i,a.Earth,"\u571f"),Object(g.a)(i,a.Electric,"\u7535"),Object(g.a)(i,a.Fire,"\u706b"),Object(g.a)(i,a.Water,"\u6c34"),Object(g.a)(i,a.Wind,"\u98ce"),i),v=function(t){function e(t){var n;return Object(c.a)(this,e),(n=Object(h.a)(this,Object(d.a)(e).call(this,t))).handleDpChange=n.handleDpChange.bind(Object(p.a)(n)),n.handlePositionChange=n.handlePositionChange.bind(Object(p.a)(n)),n.handleNameChange=n.handleNameChange.bind(Object(p.a)(n)),n}return Object(m.a)(e,t),Object(u.a)(e,[{key:"handleDpChange",value:function(t){var e=this.copyBattler(this.props.battler);e.dp=Number.parseInt(t.target.value),this.props.onBattlerChanged(e)}},{key:"handlePositionChange",value:function(t){var e=Number.parseInt(t.target.value);if(e>=0&&e<6){var n=this.copyBattler(this.props.battler);n.position=e,this.props.onBattlerChanged(n)}}},{key:"handleNameChange",value:function(t){var e=this.copyBattler(this.props.battler);e.name=t.target.value,this.props.onBattlerChanged(e)}},{key:"handleAttributeChange",value:function(t,e){var n=this.copyBattler(this.props.battler);n.attributeResistances[t]=Number.parseInt(e.target.value),this.props.onBattlerChanged(n)}},{key:"copyBattler",value:function(t){return{dp:t.dp,id:t.id,name:t.name,position:t.position,attributeResistances:t.attributeResistances}}},{key:"render",value:function(){var t=this;return r.a.createElement("div",{className:"battler-info"},r.a.createElement("p",null,"DP: ",r.a.createElement("input",{type:"number",onChange:this.handleDpChange,value:this.props.battler.dp})),r.a.createElement("p",null,"\u4f4d\u7f6e: ",r.a.createElement("input",{type:"number",onChange:this.handlePositionChange,value:this.props.battler.position,min:"0",max:"5"})),r.a.createElement("p",null,"\u540d\u79f0: ",r.a.createElement("input",{type:"text",onChange:this.handleNameChange,value:this.props.battler.name})),r.a.createElement("div",null,r.a.createElement("p",null,"\u6297\u6027"),[a.Earth,a.Electric,a.Fire,a.Water,a.Wind].map(function(e,n){return r.a.createElement("p",{key:n},b[e],r.a.createElement("input",{value:t.props.battler.attributeResistances[e],onChange:t.handleAttributeChange.bind(t,e)}))})))}}]),e}(r.a.Component),f=function(t){function e(t){var n;return Object(c.a)(this,e),(n=Object(h.a)(this,Object(d.a)(e).call(this,t))).side=void 0,n.handleHpChange=n.handleHpChange.bind(Object(p.a)(n)),n.handleSpChange=n.handleSpChange.bind(Object(p.a)(n)),n.addBattler=n.addBattler.bind(Object(p.a)(n)),n.side={hp:0,sp:0,battlers:[]},n}return Object(m.a)(e,t),Object(u.a)(e,[{key:"handleHpChange",value:function(t){var e=this.copySide(this.props.side);e.hp=Number.parseInt(t.target.value),this.props.onSideChanged(e)}},{key:"handleSpChange",value:function(t){var e=this.copySide(this.props.side);e.sp=Number.parseInt(t.target.value),this.props.onSideChanged(e)}},{key:"handleBattlerChanged",value:function(t,e){var n=this.copySide(this.props.side);n.battlers[t]=e,this.props.onSideChanged(n)}},{key:"addBattler",value:function(){var t,e=this.copySide(this.props.side),n=e.battlers,i={dp:0,name:"",attributeResistances:(t={},Object(g.a)(t,a.Earth,0),Object(g.a)(t,a.Electric,0),Object(g.a)(t,a.Fire,0),Object(g.a)(t,a.Water,0),Object(g.a)(t,a.Wind,0),t),id:n.length,position:0};n.push(i),this.props.onSideChanged(e)}},{key:"copySide",value:function(t){return this.side.hp=t.hp,this.side.sp=t.sp,this.side.battlers=t.battlers,this.side}},{key:"render",value:function(){var t=this;return r.a.createElement("div",null,r.a.createElement("p",null,"HP: ",r.a.createElement("input",{type:"number",onChange:this.handleHpChange,value:this.props.side.hp})," "),r.a.createElement("p",null,"SP: ",r.a.createElement("input",{type:"number",onChange:this.handleSpChange,value:this.props.side.sp})),r.a.createElement("div",null,r.a.createElement("p",null,"\u89d2\u8272\uff1a"),this.props.side.battlers.map(function(e,n){return r.a.createElement(v,{battler:e,onBattlerChanged:t.handleBattlerChanged.bind(t,n),key:e.id})}),r.a.createElement("button",{onClick:this.addBattler},"+")))}}]),e}(r.a.Component),k=function(t){function e(t){var n;return Object(c.a)(this,e),(n=Object(h.a)(this,Object(d.a)(e).call(this,t))).action=void 0,n.action={spCost:0,hpDamage:0,attribute:a.Fire,attributeDamage:0,targetArea:[],name:""},n.onAttributeChanged=n.onAttributeChanged.bind(Object(p.a)(n)),n.onAttributeDamageChanged=n.onAttributeDamageChanged.bind(Object(p.a)(n)),n.onHpDamageChanged=n.onHpDamageChanged.bind(Object(p.a)(n)),n.onSpCostChanged=n.onSpCostChanged.bind(Object(p.a)(n)),n.onNameChanged=n.onNameChanged.bind(Object(p.a)(n)),n}return Object(m.a)(e,t),Object(u.a)(e,[{key:"copyAction",value:function(t){return this.action.spCost=t.spCost,this.action.targetArea=t.targetArea,this.action.hpDamage=t.hpDamage,this.action.attribute=t.attribute,this.action.attributeDamage=t.attributeDamage,this.action.name=t.name,this.action}},{key:"handleAreaClicked",value:function(t,e,n){var a=this.copyAction(this.props.action),i=a.targetArea.findIndex(function(n){return n[0]===t&&n[1]===e});n.target.checked?i<0&&a.targetArea.push([t,e]):i>=0&&a.targetArea.splice(i,1),this.props.onActionChanged(a)}},{key:"isAreaChecked",value:function(t,e){return void 0!==this.props.action.targetArea.find(function(n){return n[0]===t&&n[1]===e})}},{key:"onAttributeChanged",value:function(t){var e=this.copyAction(this.props.action);e.attribute=Number.parseInt(t.target.value),this.props.onActionChanged(e)}},{key:"onHpDamageChanged",value:function(t){var e=this.copyAction(this.props.action);e.hpDamage=Number.parseInt(t.target.value),this.props.onActionChanged(e)}},{key:"onSpCostChanged",value:function(t){var e=this.copyAction(this.props.action);e.spCost=Number.parseInt(t.target.value),this.props.onActionChanged(e)}},{key:"onAttributeDamageChanged",value:function(t){var e=this.copyAction(this.props.action);e.attributeDamage=Number.parseInt(t.target.value),this.props.onActionChanged(e)}},{key:"onNameChanged",value:function(t){var e=this.copyAction(this.props.action);e.name=t.target.value,this.props.onActionChanged(e)}},{key:"render",value:function(){var t=this;return r.a.createElement("div",{className:"action-view"},r.a.createElement("p",null,"\u540d\u79f0: ",r.a.createElement("input",{type:"text",value:this.props.action.name,onChange:this.onNameChanged})),r.a.createElement("p",null,"HP\u4f24\u5bb3: ",r.a.createElement("input",{type:"number",value:this.props.action.hpDamage,onChange:this.onHpDamageChanged})),r.a.createElement("p",null,"SP\u6d88\u8017: ",r.a.createElement("input",{type:"number",value:this.props.action.spCost,onChange:this.onSpCostChanged})),r.a.createElement("p",null,"\u5c5e\u6027\u4f24\u5bb3: ",r.a.createElement("input",{type:"number",value:this.props.action.attributeDamage,onChange:this.onAttributeDamageChanged})),r.a.createElement("p",null,"\u5c5e\u6027:",r.a.createElement("select",{onChange:this.onAttributeChanged,value:this.props.action.attribute},r.a.createElement("option",{value:a.Earth},"\u571f"),r.a.createElement("option",{value:a.Electric},"\u7535"),r.a.createElement("option",{value:a.Fire},"\u706b"),r.a.createElement("option",{value:a.Water},"\u6c34"),r.a.createElement("option",{value:a.Wind},"\u98ce"))),r.a.createElement("div",null,r.a.createElement("p",null,"\u76ee\u6807\u8303\u56f4"),r.a.createElement("table",null,r.a.createElement("tbody",null,[-2,-1,0,1,2].map(function(e){return r.a.createElement("tr",{key:e},[-2,-1,0,1,2].map(function(n){return r.a.createElement("td",{key:n},r.a.createElement("input",{type:"checkbox",onChange:t.handleAreaClicked.bind(t,e,n),checked:t.isAreaChecked(e,n)}))}))})))))}}]),e}(r.a.Component);function C(t){return r.a.createElement("div",{className:"modal-container show"},r.a.createElement("div",{className:"modal load-dialog"},r.a.createElement("p",{className:"modal-header"},r.a.createElement("span",{className:"modal-title"},"\u8bfb\u53d6\u5b58\u6863"),r.a.createElement("span",null,r.a.createElement("button",{className:"anchor-like-button",onClick:function(){return t.onClosed()}},"[X]"))),t.saves.map(function(e,n){return r.a.createElement("p",{className:"load-names",key:n,onClick:function(){return t.onLoad(e)}},e)})))}var E=function(t){function e(t){var n;return Object(c.a)(this,e),(n=Object(h.a)(this,Object(d.a)(e).call(this,t))).state={side:{hp:0,sp:0,battlers:[]},side2:{hp:0,sp:0,battlers:[]},actions:[],loadShowing:!1,saves:[]},n.handleSideChanged=n.handleSideChanged.bind(Object(p.a)(n)),n.handleSide2Changed=n.handleSide2Changed.bind(Object(p.a)(n)),n.onAddAction=n.onAddAction.bind(Object(p.a)(n)),n.onComplete=n.onComplete.bind(Object(p.a)(n)),n}return Object(m.a)(e,t),Object(u.a)(e,[{key:"handleSideChanged",value:function(t){this.setState({side:t})}},{key:"handleSide2Changed",value:function(t){this.setState({side2:t})}},{key:"onActionChanged",value:function(t,e){this.setState(function(n){var a=n.actions;return a[t]=e,{actions:a}})}},{key:"onAddAction",value:function(){this.setState(function(t){var e=t.actions;return e.push({hpDamage:0,spCost:0,attribute:a.Earth,attributeDamage:0,targetArea:[],name:""}),{actions:e}})}},{key:"onComplete",value:function(){this.props.onComplete(this.state.side,this.state.side2,this.state.actions)}},{key:"onSave",value:function(){var t=window.prompt("\u5b58\u6863\u540d\u79f0\uff08\u540c\u540d\u4f1a\u81ea\u52a8\u8986\u76d6\uff09",(new Date).toLocaleString());if(null!==t&&""!==(t=t.trim()))if("_saveMetaItem"!==t){var e,n=JSON.stringify({side:this.state.side,side2:this.state.side2,actions:this.state.actions}),a=localStorage.getItem("_saveMetaItem");if(-1!==(e=null===a?[]:JSON.parse(a)).findIndex(function(e){return e===t})){if(!1===window.confirm("\u5b58\u5728\u540c\u540d\u5b58\u6863\uff0c\u662f\u5426\u8986\u76d6\uff1f"))return}else e.push(t);localStorage.setItem("_saveMetaItem",JSON.stringify(e)),localStorage.setItem(t,n)}else window.alert("\u975e\u6cd5\u540d\u79f0")}},{key:"onLoad",value:function(){var t=localStorage.getItem("_saveMetaItem");if(null!==t){var e=JSON.parse(t);this.setState({loadShowing:!0,saves:e})}else alert("\u65e0\u5b58\u6863")}},{key:"onLoadCanceled",value:function(){this.setState({loadShowing:!1})}},{key:"onLoadSelected",value:function(t){var e=localStorage.getItem(t);if(null===e)return alert("\u8bfb\u53d6\u9519\u8bef\uff01"),void this.setState({loadShowing:!1});var n=JSON.parse(e);this.setState({loadShowing:!1,side:n.side,side2:n.side2,actions:n.actions})}},{key:"render",value:function(){var t=this;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"platform"},r.a.createElement("div",{className:"sides-info-view"},r.a.createElement(f,{side:this.state.side,onSideChanged:this.handleSideChanged}),r.a.createElement("p",{className:"vs"},"VS"),r.a.createElement(f,{side:this.state.side2,onSideChanged:this.handleSide2Changed})),r.a.createElement("div",{className:"actions-view"},r.a.createElement("p",null,"\u884c\u52a8:"),this.state.actions.map(function(e,n){return r.a.createElement(k,{action:e,onActionChanged:t.onActionChanged.bind(t,n),key:n})}),r.a.createElement("button",{onClick:this.onAddAction},"+")),r.a.createElement("div",{className:"footer-view"},r.a.createElement("button",{onClick:this.onComplete},"\u5b8c\u6210"),r.a.createElement("button",{onClick:function(){return t.onSave()}},"\u4fdd\u5b58"),r.a.createElement("button",{onClick:function(){return t.onLoad()}},"\u8bfb\u53d6"))),this.state.loadShowing?r.a.createElement(C,{saves:this.state.saves,onClosed:function(){return t.onLoadCanceled()},onLoad:function(e){return t.onLoadSelected(e)}}):null)}}]),e}(r.a.Component),A=n(12),y=function(){function t(e,n){Object(c.a)(this,t),this.dp=void 0,this.attributeResistances=void 0,this.side=void 0,this.currentAttribute=void 0,this.weakState=void 0,this.thisTurnDpDamaged=void 0,this.position=void 0,this.name=void 0,this.id=void 0,this.position=n.position,this.side=e,this.dp=n.dp,this.attributeResistances=n.attributeResistances,this.currentAttribute={attribute:null,point:0},this.weakState=!1,this.thisTurnDpDamaged=!1,this.name=n.name,this.id=n.id}return Object(u.a)(t,[{key:"getCurrentAttribute",value:function(){return this.currentAttribute.attribute}},{key:"getAttributePoint",value:function(){return this.currentAttribute.point}},{key:"applyAttributeDamage",value:function(t,e){var n={dpDamage:0,attributePointAttached:0,knockedIntoWeak:!1,attribute:null};if(this.weakState&&!this.thisTurnDpDamaged&&(n.dpDamage=1,this.dp-=1,this.thisTurnDpDamaged=!0),this.weakState)return n;n.attribute=t,n.attributePointAttached=e,this.currentAttribute.attribute===t?this.currentAttribute.point+=e:(this.currentAttribute.attribute=t,this.currentAttribute.point=e);var a=this.attributeResistances[t];return 0!==a&&a<=this.currentAttribute.point&&(this.weakState=!0,this.currentAttribute.point=0,n.knockedIntoWeak=!0),n}},{key:"onTurnStart",value:function(){this.thisTurnDpDamaged=!1,this.weakState=!1}},{key:"isDead",value:function(){return this.dp<=0}},{key:"isWeakState",value:function(){return this.weakState}}]),t}(),S=function(){function t(e){var n=this;Object(c.a)(this,t),this.opponent=void 0,this.damageMultiplier=void 0,this.thisActionDamageMultiplier=void 0,this.damageMultiplierDelta=void 0,this.battlers=void 0,this.hp=void 0,this.sp=void 0,this.battlers=e.battlers.map(function(t){return new y(n,t)}),this.damageMultiplier=1,this.thisActionDamageMultiplier=1,this.damageMultiplierDelta=.2,this.opponent=null,this.hp=e.hp,this.sp=e.sp}return Object(u.a)(t,[{key:"getBattler",value:function(t){var e=2*t[0]+t[1];return this.battlers.find(function(t){return t.position===e})}},{key:"setOpponent",value:function(t){this.opponent=t}},{key:"applyHpDamage",value:function(t){return this.hp-=t,this.hp<0&&(this.hp=0),{hpDamage:t,isDead:0===this.hp}}},{key:"onDamageWeakState",value:function(t){var e={multiplierAdded:this.damageMultiplierDelta};return this.thisActionDamageMultiplier+=this.damageMultiplierDelta,this.damageMultiplierDelta+=.2,e}},{key:"onActionEnd",value:function(){this.damageMultiplier=this.thisActionDamageMultiplier}},{key:"onTurnStart",value:function(){this.damageMultiplier=1,this.thisActionDamageMultiplier=1,this.damageMultiplierDelta=.2,this.battlers.forEach(function(t){return t.onTurnStart()})}},{key:"getDisplayDamageMultiplier",value:function(){return this.thisActionDamageMultiplier}}]),t}(),D=function(){function t(e,n,a,i){Object(c.a)(this,t),this.user=void 0,this.targets=void 0,this.data=void 0,this.id=void 0,this.attack=void 0,this.targetPoint=void 0,this.data=e,this.targets=null,this.attack=null,this.user=n,this.targetPoint=a,this.id=i}return Object(u.a)(t,[{key:"canUse",value:function(){return!this.user.isDead()}},{key:"step",value:function(){var t=this;if(!this.canUse())return!1;if(null===this.targets){var e=this.user.side.opponent;this.targets=this.data.targetArea.map(function(n){var a=t.targetPoint[0]+n[0],i=t.targetPoint[1]+n[1];if(!(a>2||a<0||i>1||i<0))return e.getBattler([a,i])}).filter(function(t){return void 0!==t})}if(0===this.targets.length)return this.user.side.onActionEnd(),!1;var n=this.targets.shift();return this.attack=new O(this.user,n,this),!0}},{key:"getCurrentAttack",value:function(){return this.attack}}]),t}(),O=function t(e,n,a){Object(c.a)(this,t),this.user=void 0,this.target=void 0,this.action=void 0,this.hpDamageResult=void 0,this.damageMultiplierResult=void 0,this.attributeDamageResult=void 0,this.user=e,this.target=n,this.action=a;var i=this.user.side.damageMultiplier*this.action.data.hpDamage;this.hpDamageResult=this.target.side.applyHpDamage(i),this.damageMultiplierResult=null,this.action.data.attribute===this.target.getCurrentAttribute()&&this.target.isWeakState()&&(this.damageMultiplierResult=this.user.side.onDamageWeakState(this.action)),this.attributeDamageResult=this.target.applyAttributeDamage(this.action.data.attribute,this.action.data.attributeDamage)},j=n(23),_=function(){function t(e,n){Object(c.a)(this,t),this._sideA=void 0,this._sideB=void 0,this._actions=void 0,this._phase=void 0,this._inputtingPhase=void 0,this._actionResults=void 0,this.currentProcessingAction=void 0,this._inputtingAction=void 0,this._currentInputtingBattler=void 0,this._nextActionId=void 0,this._sideA=new S(e),this._sideB=new S(n),this._sideA.setOpponent(this._sideB),this._sideB.setOpponent(this._sideA),this._actions=new j.a([]),this._phase=new j.a(void 0),this._inputtingPhase=new j.a(void 0),this._actionResults=new j.a([]),this._actions.next([]),this._actionResults.next([]),this.currentProcessingAction=void 0,this.startTurn(),this._nextActionId=0}return Object(u.a)(t,[{key:"addAction",value:function(t){return this.checkInputting("decideAction"),!(t.spCost>this._currentInputtingBattler.side.sp)&&(this._inputtingAction=t,this._inputtingPhase.next("decideTarget"),!0)}},{key:"setTarget",value:function(t){this._inputtingAction.spCost<=this._currentInputtingBattler.side.sp&&(this._currentInputtingBattler.side.sp-=this._inputtingAction.spCost,this._actions.value.push(new D(this._inputtingAction,this._currentInputtingBattler,t,this._nextActionId)),++this._nextActionId),this._inputtingPhase.next("decideBattler")}},{key:"selectBattler",value:function(t){this.checkInputting("decideBattler"),this._currentInputtingBattler=t,this._inputtingPhase.next("decideAction")}},{key:"checkInputting",value:function(t){if("inputting"!==this._phase.value)throw new Error("phase must be inputting");if(this._inputtingPhase.value!==t)throw new Error("inputting phase must be "+t)}},{key:"endInputting",value:function(){this._phase.next("processing"),this._inputtingPhase.next(void 0),this._actionResults.value.length=0,this._actionResults.next(this._actionResults.value),this.updateLoop()}},{key:"updateLoop",value:function(){var t=this;this.update(),"processing"===this._phase.value&&setTimeout(function(){return t.updateLoop()},200)}},{key:"update",value:function(){if("inputting"===this._phase.value)throw new Error("You shouldn't call update in inputting state.");for(;;){if(void 0!==this.currentProcessingAction&&this.currentProcessingAction.step())return this._actionResults.value.push(this.currentProcessingAction.getCurrentAttack()),void this._actionResults.next(this._actionResults.value);if(this.currentProcessingAction=this._actions.value.shift(),this._actions.next(this._actions.value),void 0===this.currentProcessingAction){this.startTurn();break}}}},{key:"cancelTargetSelection",value:function(){this.checkInputting("decideTarget"),this._inputtingAction=void 0,this._inputtingPhase.next("decideAction")}},{key:"cancelActionSelection",value:function(){this.checkInputting("decideAction"),this._currentInputtingBattler=void 0,this._inputtingPhase.next("decideBattler")}},{key:"startTurn",value:function(){this._sideA.onTurnStart(),this._sideB.onTurnStart(),this._phase.next("inputting"),this._inputtingPhase.next("decideBattler")}},{key:"onActionDeleted",value:function(t){this.checkInputting("decideBattler");var e=this._actions.value.findIndex(function(e){return e.id===t}),n=this._actions.value.splice(e,1),a=Object(A.a)(n,1)[0];a.user.side.sp+=a.data.spCost,this._actions.next(this._actions.value)}},{key:"phase",get:function(){return this._phase}},{key:"sideA",get:function(){return this._sideA}},{key:"sideB",get:function(){return this._sideB}},{key:"actions",get:function(){return this._actions}},{key:"inputtingPhase",get:function(){return this._inputtingPhase}},{key:"actionResults",get:function(){return this._actionResults}},{key:"inputtingAction",get:function(){return this._inputtingAction}},{key:"targets",get:function(){return void 0===this._currentInputtingBattler?void 0:this._currentInputtingBattler.side.opponent.battlers}}]),t}(),P=n(8);function w(t){var e=t.battler.getCurrentAttribute(),n="\u65e0";if(null!==e)switch(e){case a.Fire:n="\u706b";break;case a.Water:n="\u6c34";break;case a.Wind:n="\u98ce";break;case a.Electric:n="\u7535";break;case a.Earth:n="\u571f"}return r.a.createElement("p",{className:"battler",onClick:function(e){return t.onClick(t.battler)}},r.a.createElement("b",null,t.battler.name)," \xa0",r.a.createElement("b",null,"DP: ")," ",t.battler.dp," | \xa0",r.a.createElement("b",null,"\u5c5e\u6027\uff1a"),n,"[",t.battler.getAttributePoint(),"]",r.a.createElement("span",{className:t.battler.isWeakState()?"":"hidden"},"| \u5f31\u70b9"),r.a.createElement("span",{className:t.battler.isDead()?"":"hidden"},"| \u6b7b\u4ea1"))}function B(t){return r.a.createElement("div",{className:"side-view"},r.a.createElement("p",null,r.a.createElement("b",null,"HP:")," ",t.side.hp),r.a.createElement("p",null,r.a.createElement("b",null,"SP:")," ",t.side.sp),t.side.battlers.map(function(e){return r.a.createElement(w,{battler:e,key:e.id,onClick:t.onBattlerClick})}))}function M(t){return r.a.createElement("tr",null,r.a.createElement(N,{onHover:t.onHover,onClick:t.onClick,x:t.x,y:0,battlers:t.battlers,highlighted:t.highlighted}),r.a.createElement(N,{onHover:t.onHover,onClick:t.onClick,x:t.x,y:1,battlers:t.battlers,highlighted:t.highlighted}))}function N(t){var e=2*t.x+t.y;return r.a.createElement("td",{onMouseLeave:function(){return t.onHover(!1,[t.x,t.y])},onMouseEnter:function(){return t.onHover(!0,[t.x,t.y])},className:"".concat(t.highlighted[e]?"highlighted":""," target-cell"),onClick:function(e){return t.onClick([t.x,t.y])}},null==t.battlers[e]?"":t.battlers[e].name)}var I,R=function(t){function e(t){var n;return Object(c.a)(this,e),(n=Object(h.a)(this,Object(d.a)(e).call(this,t))).state={hoveredPosition:void 0},n.onTargetSelected=n.onTargetSelected.bind(Object(p.a)(n)),n.onHover=n.onHover.bind(Object(p.a)(n)),n}return Object(m.a)(e,t),Object(u.a)(e,[{key:"onTargetSelected",value:function(t){this.props.onTargetSelected(t)}},{key:"onHover",value:function(t,e){t?this.setState({hoveredPosition:e}):this.setState(function(t){return void 0!==t.hoveredPosition&&t.hoveredPosition[0]===e[0]&&t.hoveredPosition[1]===e[1]?{hoveredPosition:void 0}:{hoveredPosition:t.hoveredPosition}})}},{key:"render",value:function(){var t=this,e=[];if(void 0!==this.state.hoveredPosition){var n=this.state.hoveredPosition[0],a=this.state.hoveredPosition[1];this.props.areas.forEach(function(t){var i=n+t[0],s=a+t[1];i>=0&&i<=2&&s>=0&&s<=1&&e.push(2*i+s)})}var i=Array(6).fill(!1);e.forEach(function(t){return i[t]=!0});var s=Array(6).fill(null);return this.props.battlers.forEach(function(t){return s[t.position]=t}),r.a.createElement("div",{className:"modal target"},r.a.createElement("p",{className:"modal-header"},r.a.createElement("span",{className:"modal-title"},"\u9009\u62e9\u76ee\u6807"),r.a.createElement("button",{className:"modal-close anchor-like-button",onClick:function(e){return t.props.onClose()}},"[X]")),r.a.createElement("table",{className:"target-table"},r.a.createElement("tbody",null,[0,1,2].map(function(e){return r.a.createElement(M,{key:e,onHover:t.onHover,onClick:t.onTargetSelected,x:e,battlers:s,highlighted:i})}))))}}]),e}(r.a.Component),T=(I={},Object(g.a)(I,a.Earth,"\u5730"),Object(g.a)(I,a.Electric,"\u7535"),Object(g.a)(I,a.Fire,"\u706b"),Object(g.a)(I,a.Water,"\u6c34"),Object(g.a)(I,a.Wind,"\u98ce"),I);function x(t){var e=null;null!==t.result.attributeDamageResult.attribute&&(e=r.a.createElement(r.a.Fragment,null,r.a.createElement("p",null,"\u9644\u52a0\u4e86 ",t.result.attributeDamageResult.attributePointAttached," \u70b9 ",T[t.result.attributeDamageResult.attribute]," "),r.a.createElement("p",null,t.result.attributeDamageResult.knockedIntoWeak?"\u6253\u5165\u4e86\u5f31\u70b9\u72b6\u6001":"",t.result.attributeDamageResult.dpDamage>0?"\u9020\u6210\u4e86".concat(t.result.attributeDamageResult.dpDamage,"\u70b9DP\u4f24\u5bb3"):""," ")));var n=null;return null!==t.result.damageMultiplierResult&&(n=r.a.createElement("p",null,"\u4f24\u5bb3\u63d0\u5347\u7387\u4e0a\u6da8\u4e86: ",t.result.damageMultiplierResult.multiplierAdded)),r.a.createElement("div",null,r.a.createElement("p",null,t.result.action.user.name," \u5bf9 ",t.result.target.name," \u4f7f\u7528\u4e86 ",t.result.action.data.name),r.a.createElement("p",null,"\u9020\u6210\u4e86 ",t.result.hpDamageResult.hpDamage," \u70b9\u4f24\u5bb3 ",t.result.hpDamageResult.isDead?"\u5bf9\u9762\u5df2\u6b7b\u4ea1":""),e,n)}function V(t){return r.a.createElement("p",{onClick:function(){return t.onClicked(t.action)},className:"action"},r.a.createElement("span",null,t.action.name),"\xa0",r.a.createElement("span",null,r.a.createElement("b",null,"SP\u6d88\u8017:"),t.action.spCost))}function H(t){return r.a.createElement("div",{className:"actions modal"},r.a.createElement("p",{className:"modal-header"},r.a.createElement("span",{className:"modal-title"},"\u9009\u62e9\u884c\u52a8\uff1a"),r.a.createElement("button",{className:"modal-close anchor-like-button",onClick:function(){return t.onActionSelectionClosed()}},"[X]")),t.actionDatas.map(function(e,n){return r.a.createElement(V,{action:e,key:n,onClicked:function(){return t.onActionClicked(e)}})}))}function W(t){return r.a.createElement("div",{className:"action-records"},t.actions.map(function(e){return r.a.createElement("p",{key:e.id,className:"action-record"},r.a.createElement("span",null,e.user.name),r.a.createElement("span",{className:"action-record-action-name"},e.data.name),r.a.createElement("button",{className:"anchor-like-button action-record-delete",onClick:function(n){n.preventDefault(),t.onActionDeleted(e.id)}},"X"))}))}var F=function(t){function e(t){var n;return Object(c.a)(this,e),(n=Object(h.a)(this,Object(d.a)(e).call(this,t))).subscription=void 0,n.battleVM=void 0,n.previousProps=void 0,n.state={phase:void 0,inputtingPhase:void 0,actionResults:[],actions:[]},n.onActionClicked=n.onActionClicked.bind(Object(p.a)(n)),n.onTargetSelected=n.onTargetSelected.bind(Object(p.a)(n)),n.onBattlerSelected=n.onBattlerSelected.bind(Object(p.a)(n)),n.onTargetSelectionClosed=n.onTargetSelectionClosed.bind(Object(p.a)(n)),n.onActionSelectionClosed=n.onActionSelectionClosed.bind(Object(p.a)(n)),n.onActionDeleted=n.onActionDeleted.bind(Object(p.a)(n)),n}return Object(m.a)(e,t),Object(u.a)(e,[{key:"createVM",value:function(){var t=this;this.subscription.unsubscribe(),this.subscription=new P.a,this.battleVM=void 0,void 0!==this.props.sideA&&void 0!==this.props.sideB&&(this.battleVM=new _(this.props.sideA,this.props.sideB),this.battleVM.phase.subscribe(function(e){return t.setState({phase:e})}),this.battleVM.inputtingPhase.subscribe(function(e){return t.setState({inputtingPhase:e})}),this.battleVM.actionResults.subscribe(function(e){return t.setState({actionResults:e})}),this.battleVM.actions.subscribe(function(e){return t.setState({actions:e})}))}},{key:"recreateBattleVM",value:function(){this.previousProps!==this.props&&(this.previousProps=this.props,void 0!==this.subscription&&(this.subscription.unsubscribe(),this.subscription=void 0),this.battleVM=void 0,void 0!==this.props.sideA&&void 0!==this.props.sideB&&(this.battleVM=new _(this.props.sideA,this.props.sideB)))}},{key:"registerSubscriptions",value:function(){var t=this;if(void 0===this.subscription&&void 0!==this.battleVM){var e=[];e[0]=this.battleVM.phase.subscribe(function(e){return t.setState({phase:e})}),e[1]=this.battleVM.inputtingPhase.subscribe(function(e){return t.setState({inputtingPhase:e})}),e[2]=this.battleVM.actionResults.subscribe(function(e){return t.setState({actionResults:e})}),e[3]=this.battleVM.actions.subscribe(function(e){return t.setState({actions:e})}),this.subscription=new P.a,e.forEach(function(e){return t.subscription.add(e)})}}},{key:"componentDidMount",value:function(){this.registerSubscriptions()}},{key:"componentDidUpdate",value:function(){this.registerSubscriptions()}},{key:"onActionClicked",value:function(t){this.battleVM.addAction(t)}},{key:"onTargetSelected",value:function(t){this.battleVM.setTarget(t)}},{key:"onBattlerSelected",value:function(t){this.battleVM.selectBattler(t)}},{key:"onEndTurn",value:function(){this.battleVM.endInputting()}},{key:"onTargetSelectionClosed",value:function(){this.battleVM.cancelTargetSelection()}},{key:"onActionSelectionClosed",value:function(){this.battleVM.cancelActionSelection()}},{key:"onActionDeleted",value:function(t){this.battleVM.onActionDeleted(t)}},{key:"render",value:function(){var t=this;if(this.recreateBattleVM(),void 0===this.battleVM)return r.a.createElement(r.a.Fragment,null);var e=null;console.log(this.state.inputtingPhase),void 0!==this.props.actionDatas&&"decideAction"===this.state.inputtingPhase&&(e=r.a.createElement(H,{onActionClicked:this.onActionClicked,actionDatas:this.props.actionDatas,onActionSelectionClosed:this.onActionSelectionClosed}));var n=null;return"decideTarget"===this.state.inputtingPhase&&(n=r.a.createElement(R,{battlers:this.battleVM.targets,onTargetSelected:this.onTargetSelected,areas:this.battleVM.inputtingAction.targetArea,onClose:this.onTargetSelectionClosed})),r.a.createElement("div",null,r.a.createElement(B,{side:this.battleVM.sideA,onBattlerClick:this.onBattlerSelected}),r.a.createElement(B,{side:this.battleVM.sideB,onBattlerClick:this.onBattlerSelected}),r.a.createElement(W,{actions:this.state.actions,onActionDeleted:this.onActionDeleted}),"inputting"===this.state.phase?r.a.createElement("button",{onClick:function(){return t.onEndTurn()}},"\u7ed3\u675f\u56de\u5408"):null,r.a.createElement("div",{className:"modal-container ".concat(null!==e||null!==n?"show":"")},null!==e?e:r.a.createElement(r.a.Fragment,null),null!==n?n:r.a.createElement(r.a.Fragment,null)),this.state.actionResults.map(function(t,e){return r.a.createElement(x,{key:e,result:t})}))}}]),e}(r.a.Component),L=function(t){function e(t){var n;return Object(c.a)(this,e),(n=Object(h.a)(this,Object(d.a)(e).call(this,t))).state={editHidden:!1,sideViewHidden:!0,sideA:void 0,sideB:void 0,actions:[]},n.onComplete=n.onComplete.bind(Object(p.a)(n)),n}return Object(m.a)(e,t),Object(u.a)(e,[{key:"onComplete",value:function(t,e,n){this.setState({editHidden:!0,sideViewHidden:!1,sideA:t,sideB:e,actions:n})}},{key:"render",value:function(){return r.a.createElement("div",null,r.a.createElement("div",{className:this.state.editHidden?"hidden":""},r.a.createElement(E,{onComplete:this.onComplete})),this.state.sideViewHidden?r.a.createElement(r.a.Fragment,null):r.a.createElement(F,{sideA:this.state.sideA,sideB:this.state.sideB,actionDatas:this.state.actions}))}}]),e}(r.a.Component),J=function(){return r.a.createElement(L,null)};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));l.a.render(r.a.createElement(J,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(t){t.unregister()})}},[[14,1,2]]]);
//# sourceMappingURL=main.0f39d82b.chunk.js.map